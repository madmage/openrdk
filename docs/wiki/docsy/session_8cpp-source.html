<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>OpenRDK: session.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c9084856de39d2370684ea5387345f28.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_96988b6434b62dfcbfa4cb8936cee763.html">libraries</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_2e4f2d31b959059e49dce94198a3cf84.html">rdkcore</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_1ceeaac41c4e8862897ef133acb57ab1.html">repository</a>
  </div>
</div>
<div class="contents">
<h1>session.cpp</h1><a href="session_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> *    OpenRDK : OpenSource Robot Development Kit</span>
<a name="l00003"></a>00003 <span class="comment"> *    Copyright (C) 2007, 2008  Daniele Calisi, Andrea Censi (&lt;first_name&gt;.&lt;last_name&gt;@dis.uniroma1.it)</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *    This program is free software: you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment"> *    it under the terms of the GNU General Public License as published by</span>
<a name="l00007"></a>00007 <span class="comment"> *    the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00008"></a>00008 <span class="comment"> *    (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> *    This program is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment"> *    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="comment"> *    GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> *    You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment"> *    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include "<a class="code" href="repository_8h.html">repository.h</a>"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "<a class="code" href="session_8h.html" title="This file contains the Session class and some useful macros.">session.h</a>"</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="robotmodule_8h.html">rdkcore/robot/robotmodule.h</a>&gt;</span>  <span class="comment">// FIXME</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="profiling_8h.html">rdkcore/profiling/profiling.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="objectdiff_8h.html">rdkcore/object/objectdiff.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="rpropertydef_8h.html">rdkcore/repository_struct/rpropertydef.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="ryellowpages_8h.html">rdkcore/rnetobjects/ryellowpages.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="logging_8h.html">rdkcore/logging/logging.h</a>&gt;</span>
<a name="l00029"></a><a class="code" href="session_8cpp.html#abf8415093fb98fb0d75a21891caffed">00029</a> <span class="preprocessor">#define LOGGING_MODULE "Session"</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="objectmanager_8h.html">rdkcore/object/objectmanager.h</a>&gt;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="comment">//#define DEBUG_THIS</span>
<a name="l00034"></a>00034 <span class="preprocessor">#ifdef DEBUG_THIS</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#warning a lot of debug</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#define DOUT(a, args...) RDK_DEBUG_PRINTF(a, ## args)</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00038"></a><a class="code" href="session_8cpp.html#047bb0c513743edd335d0e23955c967c">00038</a> <span class="preprocessor"></span><span class="preprocessor">#define DOUT(a, args...)</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 <span class="keyword">namespace </span>RDK2 { <span class="keyword">namespace </span>RepositoryNS {
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="keyword">using namespace </span>RDK2::Profiling;
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#c294c06d0ec01e86b383ddda53b02145">00045</a> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#c294c06d0ec01e86b383ddda53b02145">Session::Session</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> sessionName, <a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> description, <a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> urlContext, <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html">Repository</a>* repository) :
<a name="l00046"></a>00046     threadIdInitialized(false), urlContext(urlContext), repository(repository),
<a name="l00047"></a>00047     sessionName(sessionName), description(description),
<a name="l00048"></a>00048     started(false), exiting(false)
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#c1d68285bd58ce08e0e9ec5f1237a819">eventQueue</a> = <span class="keyword">new</span> <a class="code" href="class_posix_queues_1_1_pipe_queue.html">PosixQueues::PipeQueue&lt;Event&gt;</a>(string()
<a name="l00051"></a>00051         + <span class="stringliteral">"Event queue for session '"</span> + sessionName + <span class="stringliteral">"'"</span>);
<a name="l00052"></a>00052     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#198e8bc5eda10e77ff1d706627f61223">consumerEventQueue</a> = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#c1d68285bd58ce08e0e9ec5f1237a819">eventQueue</a>-&gt;createConsumer(<span class="keywordtype">string</span>() + <span class="stringliteral">"Consumer event queue for session '"</span>
<a name="l00053"></a>00053         + sessionName + <span class="stringliteral">"'"</span>, <a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00054"></a>00054     <span class="comment">//RDK_DEBUG_PRINTF("Session '%s': creating", this-&gt;sessionName.c_str());</span>
<a name="l00055"></a>00055 }
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#90746082f55caaa62eeee83247933590">00057</a> Session::~Session()
<a name="l00058"></a>00058 {
<a name="l00059"></a>00059     <a class="code" href="modulemanager_8cpp.html#d37a99f4f3d6808865b6cabc829ae38d">DOUT</a>(<span class="stringliteral">"Deleting session %x (%s)"</span>, <span class="keyword">this</span>, <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a>.c_str());
<a name="l00060"></a>00060     <span class="comment">// delete the session from the listening sessions of each property</span>
<a name="l00061"></a>00061     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f02f1ae26ef18c2860c5be0974130184" title="Repository properties.">propertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00062"></a>00062     <span class="keywordflow">for</span> (map&lt;Url, Property*&gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#66a9dd626a4daf33d0eff91cde9d816d">localProperties</a>.begin();
<a name="l00063"></a>00063     it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#66a9dd626a4daf33d0eff91cde9d816d">localProperties</a>.end(); ++it) {
<a name="l00064"></a>00064         set&lt;Session*&gt;::iterator fs = it-&gt;second-&gt;listeningSessions.find(<span class="keyword">this</span>);
<a name="l00065"></a>00065         <span class="keywordflow">if</span> (fs != it-&gt;second-&gt;listeningSessions.end()) {
<a name="l00066"></a>00066             <a class="code" href="modulemanager_8cpp.html#d37a99f4f3d6808865b6cabc829ae38d">DOUT</a>(<span class="stringliteral">"Session %x was listening to property %s"</span>, <span class="keyword">this</span>, it-&gt;first.c_str());
<a name="l00067"></a>00067             it-&gt;second-&gt;listeningSessions.erase(fs);
<a name="l00068"></a>00068         }
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070     <span class="keywordflow">for</span> (map&lt;Url, Property*&gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#2f9bbf546545d2f9a65edbdaae231ad1">remoteProperties</a>.begin();
<a name="l00071"></a>00071     it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#2f9bbf546545d2f9a65edbdaae231ad1">remoteProperties</a>.end(); ++it) {
<a name="l00072"></a>00072         set&lt;Session*&gt;::iterator fs = it-&gt;second-&gt;listeningSessions.find(<span class="keyword">this</span>);
<a name="l00073"></a>00073         <span class="keywordflow">if</span> (fs != it-&gt;second-&gt;listeningSessions.end()) {
<a name="l00074"></a>00074             <a class="code" href="modulemanager_8cpp.html#d37a99f4f3d6808865b6cabc829ae38d">DOUT</a>(<span class="stringliteral">"Session %x was listening to remote property %s"</span>, <span class="keyword">this</span>, it-&gt;first.c_str());
<a name="l00075"></a>00075             it-&gt;second-&gt;listeningSessions.erase(fs);
<a name="l00076"></a>00076         }
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f02f1ae26ef18c2860c5be0974130184" title="Repository properties.">propertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     <span class="comment">// delete the session from the sessions listening to tree changes</span>
<a name="l00081"></a>00081     <span class="comment">// XXX non ho capito se dopo l'erase in una multimap gli iteratori rimangono validi</span>
<a name="l00082"></a>00082     <span class="keywordtype">bool</span> somethingDeleted;
<a name="l00083"></a>00083     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#36743fcd69798d29ef43210c04cb842b" title="Sessions listening to tree changes.">sessionsListeningToTreeMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00084"></a>00084     <span class="keywordflow">do</span> {
<a name="l00085"></a>00085         somethingDeleted = <span class="keyword">false</span>;
<a name="l00086"></a>00086         <span class="keywordflow">for</span> (multimap&lt;string, Session*&gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#bbb49c2e4b31edd993aa8b699b4e1dc7">sessionsListeningToTree</a>.begin();
<a name="l00087"></a>00087         it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#bbb49c2e4b31edd993aa8b699b4e1dc7">sessionsListeningToTree</a>.end(); ++it) {
<a name="l00088"></a>00088             <span class="keywordflow">if</span> (it-&gt;second == <span class="keyword">this</span>) {
<a name="l00089"></a>00089                 <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#bbb49c2e4b31edd993aa8b699b4e1dc7">sessionsListeningToTree</a>.erase(it);
<a name="l00090"></a>00090                 somethingDeleted = <span class="keyword">true</span>;
<a name="l00091"></a>00091                 <span class="keywordflow">break</span>;
<a name="l00092"></a>00092             }
<a name="l00093"></a>00093         }
<a name="l00094"></a>00094     } <span class="keywordflow">while</span> (somethingDeleted);
<a name="l00095"></a>00095     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#36743fcd69798d29ef43210c04cb842b" title="Sessions listening to tree changes.">sessionsListeningToTreeMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <span class="comment">// delete the session from the sessions listening to a timer</span>
<a name="l00098"></a>00098     <span class="comment">// XXX vedi sopra</span>
<a name="l00099"></a>00099     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#4c207a746b1eb260e6ce311dc5e75415">sessionsListeningToTimerMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00100"></a>00100     <span class="keywordflow">do</span> {
<a name="l00101"></a>00101         somethingDeleted = <span class="keyword">false</span>;
<a name="l00102"></a>00102         <span class="keywordflow">for</span> (map&lt;Session*, Repository::SessionTimer&gt;::iterator it
<a name="l00103"></a>00103         = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#5200f1aa342a04e64800745ef000b7fe">sessionsListeningToTimer</a>.begin();
<a name="l00104"></a>00104         it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#5200f1aa342a04e64800745ef000b7fe">sessionsListeningToTimer</a>.end(); ++it) {
<a name="l00105"></a>00105             <span class="keywordflow">if</span> (it-&gt;first == <span class="keyword">this</span>) {
<a name="l00106"></a>00106                 <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#5200f1aa342a04e64800745ef000b7fe">sessionsListeningToTimer</a>.erase(it);
<a name="l00107"></a>00107                 somethingDeleted = <span class="keyword">true</span>;
<a name="l00108"></a>00108                 <span class="keywordflow">break</span>;
<a name="l00109"></a>00109             }
<a name="l00110"></a>00110         }
<a name="l00111"></a>00111     } <span class="keywordflow">while</span> (somethingDeleted);
<a name="l00112"></a>00112     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#4c207a746b1eb260e6ce311dc5e75415">sessionsListeningToTimerMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="comment">// delete all remote subscriptions of this session</span>
<a name="l00115"></a>00115     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_remote_subscription_register.html">RemoteSubscriptionRegister</a>* subreg = &amp;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#14b1c8c6922d178e4c13e4e256769d73">remoteSubscriptionRegister</a>;
<a name="l00116"></a>00116     subreg-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_remote_subscription_register.html#533bd779e196cc744ff9f27ebab2e63b">deleteAllSubscriptionsOfSession</a>(<span class="keyword">this</span>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="comment">// delete all owned properties</span>
<a name="l00119"></a>00119     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f93050e14b307807ee4046340b86f0a0">ownedPropertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00120"></a>00120     <span class="keywordflow">for</span> (set&lt;Url&gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#255b37e85e678bf10e30a2a7f84f2cc7">ownedProperties</a>.begin(); it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#255b37e85e678bf10e30a2a7f84f2cc7">ownedProperties</a>.end(); ++it) {
<a name="l00121"></a>00121         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#71398ec712d827f610e7779377f5e766">deleteProperty</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(*it));
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#255b37e85e678bf10e30a2a7f84f2cc7">ownedProperties</a>.clear();
<a name="l00124"></a>00124     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f93050e14b307807ee4046340b86f0a0">ownedPropertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#c1d68285bd58ce08e0e9ec5f1237a819">eventQueue</a>-&gt;deleteConsumer(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#198e8bc5eda10e77ff1d706627f61223">consumerEventQueue</a>, <a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00127"></a>00127     <span class="keyword">delete</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#c1d68285bd58ce08e0e9ec5f1237a819">eventQueue</a>;
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#fb99c5d3b0bf2b4a1d55b267891652e9">00130</a> <span class="keywordtype">bool</span> Session::isLocalProperty(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> url) <span class="keyword">const</span> <span class="keywordflow">throw</span> ()
<a name="l00131"></a>00131 {
<a name="l00132"></a>00132         <span class="keywordflow">if</span> (!url.isComplete()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00133"></a>00133         <span class="keywordflow">else</span> <span class="keywordflow">return</span> url.getHost() == repository-&gt;getRepositoryName();
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 
<a name="l00136"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5d44ffde9de12d82cf3d29510aa707df">00136</a> <span class="keywordtype">void</span> Session::start() throw (InvalidOperation)
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138     <span class="keywordflow">if</span> (!<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f03617e7efbfc703b5a871c0108e55dc">threadIdInitialized</a>) {
<a name="l00139"></a>00139         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e046471d88221d778f83deea6b118857">threadId</a> = pthread_self();
<a name="l00140"></a>00140         <span class="comment">//threadIdInitialized = true;   // FIXME occhio, questa va decommentata, ma ora non funziona</span>
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pthread_equal(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e046471d88221d778f83deea6b118857">threadId</a>, pthread_self())) {
<a name="l00143"></a>00143         <span class="keywordflow">throw</span> InvalidOperation(<span class="stringliteral">"Session '"</span> + <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">"' has been started the first time by another thread"</span>);
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#082d5b5c7e49da5aa872618d9bc9c89f">started</a>) <span class="keywordflow">throw</span> InvalidOperation(<span class="stringliteral">"Session '"</span> + <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">"' already started"</span>);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.clear();
<a name="l00149"></a>00149     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#082d5b5c7e49da5aa872618d9bc9c89f">started</a> = <span class="keyword">true</span>;
<a name="l00150"></a>00150     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#17419963e92fc5cc71cb1ae6f1534472">sessionActivityTimer</a>.<a class="code" href="class_r_d_k2_1_1_time_1_1_timer_t.html#b630ba0775b44ed8751aecbd96486ef0">start</a>();
<a name="l00151"></a>00151     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#bd23aebae342f27e228054ecc02da7cc">sessionCurrentScheduleInterval</a> = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#9c9e5a33e74d36b74cb01b682438a86a">sessionScheduleTimer</a>.<a class="code" href="class_r_d_k2_1_1_time_1_1_timer_r.html#3f0748124691ba5414e4a70527f8dc8d">getSeconds</a>();
<a name="l00152"></a>00152     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#9c9e5a33e74d36b74cb01b682438a86a">sessionScheduleTimer</a>.<a class="code" href="class_r_d_k2_1_1_time_1_1_timer_r.html#6c914fdcb48e097569623822ebcf5ca8">start</a>();
<a name="l00153"></a>00153     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#62c15c2205c00e7db4dc22bffbc4d550">Profiler::start</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a>.c_str());
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f899e52f0f5588cc3f50b862723b94d1">00156</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f899e52f0f5588cc3f50b862723b94d1">Session::profilingStartEvent</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> eventName) <span class="keywordflow">throw</span> (InvalidOperation)
<a name="l00157"></a>00157 {
<a name="l00158"></a>00158     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00159"></a>00159     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#62c15c2205c00e7db4dc22bffbc4d550">Profiler::start</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + eventName).c_str());
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#54839e34816fb8da5cc39a60f06551d3">00162</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#54839e34816fb8da5cc39a60f06551d3">Session::profilingEndEvent</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> eventName) <span class="keywordflow">throw</span> (InvalidOperation)
<a name="l00163"></a>00163 {
<a name="l00164"></a>00164     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00165"></a>00165     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#c5cccc5904e674ad3a960f2498ae5a6e">Profiler::end</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + eventName).c_str());
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00168"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#56909930a095dd4e2d2a45579f0e81d9">00168</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#56909930a095dd4e2d2a45579f0e81d9" title="End the session and complain for forgot locks.">Session::end</a>() throw (InvalidOperation)
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (!<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.empty()) {
<a name="l00173"></a>00173         <a class="code" href="logging_8h.html#771f0310bc59f63f2ccf8042f2f2a381">RDK_ERROR_PRINTF</a>(<span class="stringliteral">"STUPID USER! The following properties have not been unlocked before the session end (I do it for you):"</span>);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         <span class="keywordflow">for</span> (set&lt;string&gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.begin();
<a name="l00176"></a>00176             it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.end(); ++it)
<a name="l00177"></a>00177         {
<a name="l00178"></a>00178             <a class="code" href="logging_8h.html#771f0310bc59f63f2ccf8042f2f2a381">RDK_ERROR_PRINTF</a>(<span class="stringliteral">"   '%s'"</span>, it-&gt;c_str());
<a name="l00179"></a>00179             <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e21d09ed10b43b7a43fe9e864e1edc60" title="Unlock the selected property.">unlock</a>(*it);
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.clear();
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <span class="keywordflow">for</span> (map&lt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a>, vector&lt;ObjectDiff*&gt; &gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#1bb41594488cd6e67f9e0284bb1251db">pendingDiffs</a>.begin();
<a name="l00186"></a>00186             it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#1bb41594488cd6e67f9e0284bb1251db">pendingDiffs</a>.end(); ++it)
<a name="l00187"></a>00187         {
<a name="l00188"></a>00188             <span class="keywordflow">for</span> (vector&lt;ObjectDiff*&gt;::iterator it2 = it-&gt;second.begin();
<a name="l00189"></a>00189                 it2 != it-&gt;second.end(); ++it2)
<a name="l00190"></a>00190             <span class="keyword">delete</span> (*it2);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         it-&gt;second.clear();
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="keywordflow">try</span> {
<a name="l00196"></a>00196         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#088a22f1d5f31b99ff6b8e28218621f3">setInt</a>(<a class="code" href="robotmodule_8h.html#7f4904183e6aca986afd65bde9f0a30f">PROPERTY_MODULE_ACTIVITY_COUNTER</a>, <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#adc1d9bbafc13d203b38a4421dd2c374">getInt</a>(<a class="code" href="robotmodule_8h.html#7f4904183e6aca986afd65bde9f0a30f">PROPERTY_MODULE_ACTIVITY_COUNTER</a>) + 1);
<a name="l00197"></a>00197         <span class="keywordtype">double</span> curAct = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#17419963e92fc5cc71cb1ae6f1534472">sessionActivityTimer</a>.<a class="code" href="class_r_d_k2_1_1_time_1_1_timer_t.html#66ebad88a0e17dc9bea0356afd726052">getSeconds</a>();
<a name="l00198"></a>00198         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3ed568b0c58c987015f6a04ba85cf5ad">sessionActivityCache</a>.push_back(curAct);
<a name="l00199"></a>00199         <span class="keywordflow">if</span> (<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3ed568b0c58c987015f6a04ba85cf5ad">sessionActivityCache</a>.size() &gt; 10) <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3ed568b0c58c987015f6a04ba85cf5ad">sessionActivityCache</a>.erase(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3ed568b0c58c987015f6a04ba85cf5ad">sessionActivityCache</a>.begin());
<a name="l00200"></a>00200         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#df37c5fc44e33f97464d189c35492a57">sessionScheduleCache</a>.push_back(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#bd23aebae342f27e228054ecc02da7cc">sessionCurrentScheduleInterval</a>);
<a name="l00201"></a>00201         <span class="keywordflow">if</span> (<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#df37c5fc44e33f97464d189c35492a57">sessionScheduleCache</a>.size() &gt; 10) <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#df37c5fc44e33f97464d189c35492a57">sessionScheduleCache</a>.erase(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#df37c5fc44e33f97464d189c35492a57">sessionScheduleCache</a>.begin());
<a name="l00202"></a>00202         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#58b2c798afecaf60ccad6385bf358564">setDouble</a>(<a class="code" href="robotmodule_8h.html#680916d9690e23b3489cf9e438152c5d">PROPERTY_MODULE_LAST_ITERATION_TIMER</a>, curAct);
<a name="l00203"></a>00203         curAct = 0.;    <span class="comment">// I don't want to use another var</span>
<a name="l00204"></a>00204         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3ed568b0c58c987015f6a04ba85cf5ad">sessionActivityCache</a>.size(); i++) curAct += <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3ed568b0c58c987015f6a04ba85cf5ad">sessionActivityCache</a>[i];
<a name="l00205"></a>00205         <span class="keywordflow">if</span> (<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3ed568b0c58c987015f6a04ba85cf5ad">sessionActivityCache</a>.size() &gt; 0) {
<a name="l00206"></a>00206             <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#58b2c798afecaf60ccad6385bf358564">setDouble</a>(<a class="code" href="robotmodule_8h.html#1b2c04427970c2e2418325eda7c54ada">PROPERTY_MODULE_ITERATION_DURATION_MEAN</a>, curAct / <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3ed568b0c58c987015f6a04ba85cf5ad">sessionActivityCache</a>.size());
<a name="l00207"></a>00207         }
<a name="l00208"></a>00208         curAct = 0.;
<a name="l00209"></a>00209         <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#df37c5fc44e33f97464d189c35492a57">sessionScheduleCache</a>.size(); i++) curAct += <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#df37c5fc44e33f97464d189c35492a57">sessionScheduleCache</a>[i];
<a name="l00210"></a>00210         <span class="keywordflow">if</span> (<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#df37c5fc44e33f97464d189c35492a57">sessionScheduleCache</a>.size() &gt; 0) {
<a name="l00211"></a>00211             <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#58b2c798afecaf60ccad6385bf358564">setDouble</a>(<a class="code" href="robotmodule_8h.html#1f1c43cf1e8e89191c0615ae89eccb75">PROPERTY_MODULE_SCHEDULE_INTERVAL_MEAN</a>, curAct / <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3ed568b0c58c987015f6a04ba85cf5ad">sessionActivityCache</a>.size());
<a name="l00212"></a>00212         }
<a name="l00213"></a>00213     } <span class="keywordflow">catch</span> (<span class="keyword">const</span> SessionException&amp;) { }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#082d5b5c7e49da5aa872618d9bc9c89f">started</a> = <span class="keyword">false</span>;
<a name="l00216"></a>00216     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#c5cccc5904e674ad3a960f2498ae5a6e">Profiler::end</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a>.c_str());
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00219"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#8120725a6ad31cfdc7a5268bb7a30edf">00219</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#8120725a6ad31cfdc7a5268bb7a30edf" title="End the session not complaining for forgot locks.">Session::terminate</a>() throw()
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (!<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#082d5b5c7e49da5aa872618d9bc9c89f">started</a>) {
<a name="l00222"></a>00222         <a class="code" href="logging_8h.html#771f0310bc59f63f2ccf8042f2f2a381">RDK_ERROR_PRINTF</a>(<span class="stringliteral">"Calling terminate on a non-started session"</span>);
<a name="l00223"></a>00223         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#082d5b5c7e49da5aa872618d9bc9c89f">started</a> = <span class="keyword">true</span>;
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226     <span class="keywordflow">if</span> (!<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.empty())
<a name="l00227"></a>00227         <span class="keywordflow">for</span> (set&lt;string&gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.begin();
<a name="l00228"></a>00228                 it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.end(); ++it)
<a name="l00229"></a>00229         {
<a name="l00230"></a>00230             <a class="code" href="logging_8h.html#41ce83f634d8fc364eaed15ee5cbf4b7">RDK_DEBUG_PRINTF</a>(<span class="stringliteral">"Unlocking '%s'"</span>, it-&gt;c_str());
<a name="l00231"></a>00231             <span class="keywordflow">try</span> {
<a name="l00232"></a>00232                 <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e21d09ed10b43b7a43fe9e864e1edc60" title="Unlock the selected property.">unlock</a>(*it);
<a name="l00233"></a>00233             } <span class="keywordflow">catch</span> (<span class="keyword">const</span> SessionException&amp; e) {
<a name="l00234"></a>00234                 <a class="code" href="logging_8h.html#740a3a84230479c562d4017e03b1b00e">RDK_ERROR_STREAM</a>(<span class="stringliteral">"It seems that something is going wrong in unlocking '"</span> &lt;&lt; *it &lt;&lt; <span class="stringliteral">"'"</span>);
<a name="l00235"></a>00235             }
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.clear();
<a name="l00239"></a>00239     <span class="keywordflow">for</span> (map&lt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a>, vector&lt;ObjectDiff*&gt; &gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#1bb41594488cd6e67f9e0284bb1251db">pendingDiffs</a>.begin();
<a name="l00240"></a>00240             it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#1bb41594488cd6e67f9e0284bb1251db">pendingDiffs</a>.end(); ++it)
<a name="l00241"></a>00241     {
<a name="l00242"></a>00242         <span class="keywordflow">for</span> (vector&lt;ObjectDiff*&gt;::iterator it2 = it-&gt;second.begin();
<a name="l00243"></a>00243             it2 != it-&gt;second.end(); ++it2)
<a name="l00244"></a>00244                 <span class="keyword">delete</span> (*it2);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         it-&gt;second.clear();
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     <span class="keywordflow">try</span> {
<a name="l00250"></a>00250         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#088a22f1d5f31b99ff6b8e28218621f3">setInt</a>(<a class="code" href="robotmodule_8h.html#7f4904183e6aca986afd65bde9f0a30f">PROPERTY_MODULE_ACTIVITY_COUNTER</a>,
<a name="l00251"></a>00251             <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#adc1d9bbafc13d203b38a4421dd2c374">getInt</a>(<a class="code" href="robotmodule_8h.html#7f4904183e6aca986afd65bde9f0a30f">PROPERTY_MODULE_ACTIVITY_COUNTER</a>) + 1);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#58b2c798afecaf60ccad6385bf358564">setDouble</a>(<a class="code" href="robotmodule_8h.html#680916d9690e23b3489cf9e438152c5d">PROPERTY_MODULE_LAST_ITERATION_TIMER</a>,
<a name="l00254"></a>00254             <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#17419963e92fc5cc71cb1ae6f1534472">sessionActivityTimer</a>.<a class="code" href="class_r_d_k2_1_1_time_1_1_timer_t.html#66ebad88a0e17dc9bea0356afd726052">getSeconds</a>());
<a name="l00255"></a>00255     } <span class="keywordflow">catch</span> (<span class="keyword">const</span> SessionException&amp;) { }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#082d5b5c7e49da5aa872618d9bc9c89f">started</a> = <span class="keyword">false</span>;
<a name="l00258"></a>00258     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#c5cccc5904e674ad3a960f2498ae5a6e">Profiler::end</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a>.c_str());
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#a2521737fe238aea6e8ee3a05fb3bcf6">00261</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#a2521737fe238aea6e8ee3a05fb3bcf6" title="Create a property with &amp;quot;special&amp;quot; type.">Session::createStorage</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> className, <a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url,
<a name="l00262"></a>00262     <a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#abbfba7a9176daf3f832f1dec5a05d1b">description</a>, <a class="code" href="class_r_d_k2_1_1_object.html" title="La nuova e purificata RDK2::Object.">RDK2::Object</a>* defaultValue)
<a name="l00263"></a>00263     <span class="keywordflow">throw</span> (InvalidOperation)
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00266"></a>00266     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#e351413b2d92399b16b453337175ce6e">createStorage</a>(className, <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url),
<a name="l00267"></a>00267         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#abbfba7a9176daf3f832f1dec5a05d1b">description</a>, defaultValue);
<a name="l00268"></a>00268     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f93050e14b307807ee4046340b86f0a0">ownedPropertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00269"></a>00269     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#255b37e85e678bf10e30a2a7f84f2cc7">ownedProperties</a>.insert(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url));
<a name="l00270"></a>00270     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f93050e14b307807ee4046340b86f0a0">ownedPropertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00271"></a>00271 }
<a name="l00272"></a>00272 
<a name="l00273"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5cbb92f22cd460e8a8eb192141d48a9b">00273</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5cbb92f22cd460e8a8eb192141d48a9b" title="Set the &amp;quot;read only&amp;quot; attribute on properties.">Session::setReadonly</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url, <span class="keywordtype">bool</span> readonly)
<a name="l00274"></a>00274     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00275"></a>00275 {
<a name="l00276"></a>00276     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00277"></a>00277     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00278"></a>00278     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#152bfa19da11d19d6c89846060ba5151">setReadonly</a>(readonly);
<a name="l00279"></a>00279     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#908008552154a26e87014fd0cf68a37f">00282</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#908008552154a26e87014fd0cf68a37f">Session::setPersistent</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00285"></a>00285     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00286"></a>00286     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#2d98d6a9843049bcd2dc560cba9e0c1f">def</a>.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html#ed24d0af61f16d10e21b5d521f6ad7d9">setPersistent</a>();
<a name="l00287"></a>00287     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5915289e2d3e983972fd662fa4eafd87">00290</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5915289e2d3e983972fd662fa4eafd87">Session::setVolatile</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00293"></a>00293     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00294"></a>00294     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#2d98d6a9843049bcd2dc560cba9e0c1f">def</a>.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html#41a9395a9d7d58cea1eecc25d046b613">setVolatile</a>();
<a name="l00295"></a>00295     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00298"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#918d79c5fe5329e303cbd8c394753e73">00298</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#918d79c5fe5329e303cbd8c394753e73">Session::setKeepThis</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00299"></a>00299 {
<a name="l00300"></a>00300     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00301"></a>00301     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00302"></a>00302     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#2d98d6a9843049bcd2dc560cba9e0c1f">def</a>.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html#1fbbaaa8102a6a5dab23d355bfa54e0a">setKeepThis</a>();
<a name="l00303"></a>00303     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbaad1f84471321e33d771674a1b6460">00306</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbaad1f84471321e33d771674a1b6460">Session::setEditable</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00307"></a>00307 {
<a name="l00308"></a>00308     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00309"></a>00309     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00310"></a>00310     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#2d98d6a9843049bcd2dc560cba9e0c1f">def</a>.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html#8e3969e5e7eb806e65e0155cf175d74a">setEditable</a>();
<a name="l00311"></a>00311     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d8c365cff29f427aa38eaf8082088c9e">00314</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d8c365cff29f427aa38eaf8082088c9e">Session::setNotEditable</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00315"></a>00315 {
<a name="l00316"></a>00316     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00317"></a>00317     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00318"></a>00318     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#2d98d6a9843049bcd2dc560cba9e0c1f">def</a>.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html#dead9a60b89e8102f04fb1fd3fab89dd">setNotEditable</a>();
<a name="l00319"></a>00319     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#57b54e6730fac2b5a62b235033bed3c3">00322</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#57b54e6730fac2b5a62b235033bed3c3">Session::setExternalFileName</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> url, <a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> fileName) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00323"></a>00323 {
<a name="l00324"></a>00324     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00325"></a>00325     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00326"></a>00326     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#2d98d6a9843049bcd2dc560cba9e0c1f">def</a>.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html#148485399b94c22460088833389d4812">setExternalFileName</a>(fileName);
<a name="l00327"></a>00327     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00330"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#6d863cb74cac9658b9eae2f8a7fbd3bc">00330</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#6d863cb74cac9658b9eae2f8a7fbd3bc">Session::setExternalFileBinary</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00331"></a>00331 {
<a name="l00332"></a>00332     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00333"></a>00333     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00334"></a>00334     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#2d98d6a9843049bcd2dc560cba9e0c1f">def</a>.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html#64431c33025f22a91779f4a919b3cef7">setExternalFileBinary</a>();
<a name="l00335"></a>00335     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 
<a name="l00338"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#a62ea6ff49fd90d13d461141c1cb4d25">00338</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#a62ea6ff49fd90d13d461141c1cb4d25">Session::setExternalFileXml</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00339"></a>00339 {
<a name="l00340"></a>00340     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00341"></a>00341     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00342"></a>00342     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#2d98d6a9843049bcd2dc560cba9e0c1f">def</a>.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html#5e2d7499fd3469389e33d901dee689b4">setExternalFileXml</a>();
<a name="l00343"></a>00343     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00344"></a>00344 }
<a name="l00345"></a>00345 
<a name="l00346"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#0551925ae140c870a77ca285bbbeb308">00346</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#0551925ae140c870a77ca285bbbeb308" title="Lock the selected property.">Session::lock</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url, <a class="code" href="struct_posix_constructs_1_1_stack.html">Stack</a> s)
<a name="l00347"></a>00347     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00350"></a>00350     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a> aurl = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url);
<a name="l00351"></a>00351     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#be0897f8b3e71a3ccdc08a48bc5543b4">Profiler::lock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + aurl).c_str());
<a name="l00352"></a>00352     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#8a73935b55c13b22cd4fd8c7f9c016a0">lock</a>(aurl, s);
<a name="l00353"></a>00353     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.insert(aurl);
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e21d09ed10b43b7a43fe9e864e1edc60">00356</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e21d09ed10b43b7a43fe9e864e1edc60" title="Unlock the selected property.">Session::unlock</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00359"></a>00359     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a> aurl = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url);
<a name="l00360"></a>00360     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#c3494b990d9d503d9f03e2755617661a">unlock</a>(aurl);
<a name="l00361"></a>00361     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#6f8c98ddc3b3990d573fada126468f1e">Profiler::unlock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + aurl).c_str());
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     <span class="comment">// strustr said that v.erase(v.end()) is ok,</span>
<a name="l00364"></a>00364     <span class="comment">// but at least my std implementation doesn't know it</span>
<a name="l00365"></a>00365     set&lt;string&gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.find(aurl);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     <span class="keywordflow">if</span> (it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.end())
<a name="l00368"></a>00368         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.erase(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.find(aurl));
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e1c51b627f98c8342e501b33ec4faf25">00371</a> <span class="keyword">const</span> <a class="code" href="class_r_d_k2_1_1_object.html" title="La nuova e purificata RDK2::Object.">RDK2::Object</a>* <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e1c51b627f98c8342e501b33ec4faf25">Session::getObjectLC</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url)
<a name="l00372"></a>00372     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00375"></a>00375     <span class="keywordflow">return</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url))-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#826690463d7661dc58c6e1a8e8c98c35">getObjectLC</a>();
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#02c1bde0a20844e5149d241c9e0536e7">00378</a> <a class="code" href="class_r_d_k2_1_1_object.html" title="La nuova e purificata RDK2::Object.">RDK2::Object</a>* <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#02c1bde0a20844e5149d241c9e0536e7">Session::getObjectClone</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00381"></a>00381     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a> real = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url);
<a name="l00382"></a>00382     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00383"></a>00383     <a class="code" href="class_r_d_k2_1_1_object.html" title="La nuova e purificata RDK2::Object.">RDK2::Object</a>* ob = p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#455f9abc0761b421f97f3da068d9b7c8">getObjectL</a>();
<a name="l00384"></a>00384     <span class="keywordflow">if</span>(ob) {
<a name="l00385"></a>00385         <a class="code" href="class_r_d_k2_1_1_object.html" title="La nuova e purificata RDK2::Object.">RDK2::Object</a>* clone = ob-&gt;<a class="code" href="class_r_d_k2_1_1_object.html#7892a606b34d60877cac570b1634a626">clone</a>();
<a name="l00386"></a>00386         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#c3494b990d9d503d9f03e2755617661a">unlock</a>(real);
<a name="l00387"></a>00387         <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#6f8c98ddc3b3990d573fada126468f1e">Profiler::unlock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00388"></a>00388         <span class="keywordflow">return</span> clone;
<a name="l00389"></a>00389     } <span class="keywordflow">else</span> {
<a name="l00390"></a>00390         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#c3494b990d9d503d9f03e2755617661a">unlock</a>(real);
<a name="l00391"></a>00391         <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#6f8c98ddc3b3990d573fada126468f1e">Profiler::unlock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00392"></a>00392         <span class="keywordflow">return</span> 0;
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 
<a name="l00396"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#17a5fb4553b0a85bc27098d73c9de8e3">00396</a> <span class="keywordtype">bool</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#17a5fb4553b0a85bc27098d73c9de8e3">Session::isSet</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00397"></a>00397 {
<a name="l00398"></a>00398     <span class="keywordtype">bool</span> <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a> = <span class="keyword">false</span>;
<a name="l00399"></a>00399     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00400"></a>00400     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url);
<a name="l00401"></a>00401     r = (p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#f64ff326644e67202497762d964f4e4c">object</a> != 0);
<a name="l00402"></a>00402     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00403"></a>00403     <span class="keywordflow">return</span> r;
<a name="l00404"></a>00404 }
<a name="l00405"></a>00405 
<a name="l00406"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#a707e4e966e704a8b17e99e0ee993e38">00406</a> <a class="code" href="class_r_d_k2_1_1_object.html" title="La nuova e purificata RDK2::Object.">RDK2::Object</a>* <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#a707e4e966e704a8b17e99e0ee993e38">Session::getObjectL</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00409"></a>00409     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a> aurl = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url);
<a name="l00410"></a>00410     <span class="keywordflow">if</span> (<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.find(aurl) == <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.end())
<a name="l00411"></a>00411         <span class="keywordflow">throw</span> InvalidOperation(<span class="stringliteral">"You must lock property '"</span> + aurl + <span class="stringliteral">"' before asking its object"</span>);
<a name="l00412"></a>00412     <span class="keywordflow">return</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(aurl)-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#455f9abc0761b421f97f3da068d9b7c8">getObjectL</a>();
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00415"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30d48874367fa5fc1b17b5d9589cd404">00415</a> <span class="keywordtype">string</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30d48874367fa5fc1b17b5d9589cd404">Session::getPropertyClassName</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00416"></a>00416 {
<a name="l00417"></a>00417     <span class="keywordtype">string</span> classname;
<a name="l00418"></a>00418     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(url, <span class="keyword">false</span>);
<a name="l00419"></a>00419     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#be0897f8b3e71a3ccdc08a48bc5543b4">Profiler::lock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00420"></a>00420     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00421"></a>00421     classname = p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#c5b04454f082e73889fe123081671ef8">getObjectClassName</a>();
<a name="l00422"></a>00422     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00423"></a>00423     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#6f8c98ddc3b3990d573fada126468f1e">Profiler::unlock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00424"></a>00424     <span class="keywordflow">return</span> classname;
<a name="l00425"></a>00425 }
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#7c65a9efd456c30b3dd2b4056fc99f85">00427</a> <span class="keywordtype">string</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#7c65a9efd456c30b3dd2b4056fc99f85">Session::getPropertyDescription</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00428"></a>00428 {
<a name="l00429"></a>00429     <span class="keywordtype">string</span> desc;
<a name="l00430"></a>00430     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(url, <span class="keyword">false</span>);
<a name="l00431"></a>00431     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#be0897f8b3e71a3ccdc08a48bc5543b4">Profiler::lock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00432"></a>00432     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00433"></a>00433     desc = p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#f332da04dde3d2c971be08e764cae020">description</a>;
<a name="l00434"></a>00434     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00435"></a>00435     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#6f8c98ddc3b3990d573fada126468f1e">Profiler::unlock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00436"></a>00436     <span class="keywordflow">return</span> desc;
<a name="l00437"></a>00437 }
<a name="l00438"></a>00438 
<a name="l00439"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f305a14f65f24e2a7c3fdf0acf7f6917">00439</a> vector&lt;Url&gt; <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f305a14f65f24e2a7c3fdf0acf7f6917">Session::getPropertyNamesStartingWith</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> prefix) <span class="keywordflow">throw</span> ()
<a name="l00440"></a>00440 {
<a name="l00441"></a>00441     vector&lt;Url&gt; ret;
<a name="l00442"></a>00442     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f02f1ae26ef18c2860c5be0974130184" title="Repository properties.">propertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00443"></a>00443     <span class="keywordflow">for</span> (map&lt;Url, Property*&gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#66a9dd626a4daf33d0eff91cde9d816d">localProperties</a>.begin();
<a name="l00444"></a>00444         it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#66a9dd626a4daf33d0eff91cde9d816d">localProperties</a>.end(); ++it)
<a name="l00445"></a>00445             <span class="keywordflow">if</span> (<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#6f2115445276df1daae1bf0ed5609b23">RDK2::TextUtils::startsWith</a>(it-&gt;first, prefix.c_str()))
<a name="l00446"></a>00446                 ret.push_back(it-&gt;first);
<a name="l00447"></a>00447 
<a name="l00448"></a>00448     <span class="keywordflow">for</span> (map&lt;Url, Property*&gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#2f9bbf546545d2f9a65edbdaae231ad1">remoteProperties</a>.begin();
<a name="l00449"></a>00449         it != <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#2f9bbf546545d2f9a65edbdaae231ad1">remoteProperties</a>.end(); ++it)
<a name="l00450"></a>00450             <span class="keywordflow">if</span> (<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#6f2115445276df1daae1bf0ed5609b23">RDK2::TextUtils::startsWith</a>(it-&gt;first, prefix.c_str()))
<a name="l00451"></a>00451                 ret.push_back(it-&gt;first);
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="comment">/* Ruby:</span>
<a name="l00454"></a>00454 <span class="comment">        ret &lt;&lt; repository.localProperties.find {|name,ob| name.starts prefix}</span>
<a name="l00455"></a>00455 <span class="comment">    */</span>
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f02f1ae26ef18c2860c5be0974130184" title="Repository properties.">propertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00458"></a>00458     <span class="keywordflow">return</span> ret;
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d2e67878f37e5cf6ac6a27135e87b7e5">00461</a> vector&lt;PropertyEnumItem&gt; <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d2e67878f37e5cf6ac6a27135e87b7e5">Session::getPropertyEnumItems</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url)
<a name="l00462"></a>00462     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464     vector&lt;PropertyEnumItem&gt; enumItems;
<a name="l00465"></a>00465     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(url);
<a name="l00466"></a>00466     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#be0897f8b3e71a3ccdc08a48bc5543b4">Profiler::lock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00467"></a>00467     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00468"></a>00468     enumItems = p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#b24886e85c64cd462c765767540e2b6a">enumItems</a>;
<a name="l00469"></a>00469     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00470"></a>00470     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#6f8c98ddc3b3990d573fada126468f1e">Profiler::unlock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00471"></a>00471     <span class="keywordflow">return</span> enumItems;
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#0f5a482adfcc2da7da750fcb95246caa">00474</a> <span class="keywordtype">string</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#0f5a482adfcc2da7da750fcb95246caa">Session::getPropertyLinkTo</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476     <span class="keywordtype">string</span> linkto;
<a name="l00477"></a>00477     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(url, <span class="keyword">false</span>);
<a name="l00478"></a>00478     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#be0897f8b3e71a3ccdc08a48bc5543b4">Profiler::lock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00479"></a>00479     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00480"></a>00480     linkto = p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#cd0dedc2d8e3c138252e4fe33846fbca">isLink</a>() ? p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#0f75a8fee764ee6e6067e915dd91f660">linkTo</a> : <span class="stringliteral">""</span>;
<a name="l00481"></a>00481     <span class="comment">//RDK_DEBUG_PRINTF("Asking if link to property %s: %d '%s'", url.c_str(), p-&gt;isLink(), p-&gt;linkTo.c_str());</span>
<a name="l00482"></a>00482     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00483"></a>00483     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#6f8c98ddc3b3990d573fada126468f1e">Profiler::unlock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00484"></a>00484     <span class="keywordflow">return</span> linkto;
<a name="l00485"></a>00485 }
<a name="l00486"></a>00486 
<a name="l00487"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#303e6167b55060cd125be2d4d8832d58">00487</a> <a class="code" href="class_r_d_k2_1_1_object.html" title="La nuova e purificata RDK2::Object.">RDK2::Object</a>* <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#303e6167b55060cd125be2d4d8832d58">Session::getObjectOrCreateItL</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url)
<a name="l00488"></a>00488     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00489"></a>00489 {
<a name="l00490"></a>00490     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00491"></a>00491     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a> aurl = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url);
<a name="l00492"></a>00492     <span class="keywordflow">if</span> (<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.find(aurl) == <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#3866ca211bc5ef7eca3fe3689f226c58">lockedProperties</a>.end())
<a name="l00493"></a>00493         <span class="keywordflow">throw</span> InvalidOperation(<span class="stringliteral">"You must lock property '"</span>
<a name="l00494"></a>00494             + aurl + <span class="stringliteral">"' before asking its object"</span>);
<a name="l00495"></a>00495     <span class="keywordflow">return</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#c4a1c6bd8cfbe757d577a8b84d72579d">getObjectOrCreateItL</a>(aurl);
<a name="l00496"></a>00496 }
<a name="l00497"></a>00497 
<a name="l00498"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#402ff3024077dffe56692bb80a4b577f">00498</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#402ff3024077dffe56692bb80a4b577f">Session::deleteProperty</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00501"></a>00501     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#71398ec712d827f610e7779377f5e766">deleteProperty</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url));
<a name="l00502"></a>00502     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f93050e14b307807ee4046340b86f0a0">ownedPropertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00503"></a>00503     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#255b37e85e678bf10e30a2a7f84f2cc7">ownedProperties</a>.erase(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#255b37e85e678bf10e30a2a7f84f2cc7">ownedProperties</a>.find(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url)));
<a name="l00504"></a>00504     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#f93050e14b307807ee4046340b86f0a0">ownedPropertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00505"></a>00505 }
<a name="l00506"></a>00506 
<a name="l00507"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5aa09c1657ac458fbb70442d5db20183">00507</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5aa09c1657ac458fbb70442d5db20183">Session::linkCreate</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> first, <a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> second) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00508"></a>00508 {
<a name="l00509"></a>00509     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00510"></a>00510     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(first, <span class="keyword">false</span>);
<a name="l00511"></a>00511     <span class="keyword">delete</span> p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#f64ff326644e67202497762d964f4e4c">object</a>;   <span class="comment">// delete 0 is safe</span>
<a name="l00512"></a>00512     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#f64ff326644e67202497762d964f4e4c">object</a> = 0;
<a name="l00513"></a>00513     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#7103527b4a4c674981e4ac39cd0366f2" title="Valid when property is a link.">isLinkB</a> = <span class="keyword">true</span>;
<a name="l00514"></a>00514     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#0f75a8fee764ee6e6067e915dd91f660">linkTo</a> = second;
<a name="l00515"></a>00515     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#2d98d6a9843049bcd2dc560cba9e0c1f">def</a>.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html#b38b315e64a7e36a585b2153441aed59">setLinkTo</a>(second);
<a name="l00516"></a>00516     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#284b56e5eb571f997d79afbf34d48a2a">00519</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#284b56e5eb571f997d79afbf34d48a2a">Session::linkRemove</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> first) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00520"></a>00520 {
<a name="l00521"></a>00521     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5aa09c1657ac458fbb70442d5db20183">linkCreate</a>(first, <span class="stringliteral">""</span>);
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 
<a name="l00524"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">00524</a> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">Session::getProperty</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url, <span class="keywordtype">bool</span> followLinks)
<a name="l00525"></a>00525     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00526"></a>00526 {
<a name="l00527"></a>00527     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00528"></a>00528     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a> aurl = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url);
<a name="l00529"></a>00529     <span class="keywordflow">if</span> (!aurl.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html#389d18554fb89eaa2f7e20c60508dc88" title="Url is absolute if it isn&amp;#39;t complete and begins with a &amp;quot;/&amp;quot;.">isAbsolute</a>() &amp;&amp; !aurl.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html#9e90fb1eb460c600234f029ad7e09fc7" title="Url is complete when it has also the host part (i.e. it begins with &amp;quot;rdk://&amp;quot;)...">isComplete</a>())
<a name="l00530"></a>00530         <span class="keywordflow">throw</span> InvalidOperation(<span class="stringliteral">"Url has to be absolute or complete ('"</span> + aurl + <span class="stringliteral">"')"</span>);
<a name="l00531"></a>00531     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = 0;
<a name="l00532"></a>00532     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f02f1ae26ef18c2860c5be0974130184" title="Repository properties.">propertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00533"></a>00533     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> redirCount = 0; redirCount &lt; (followLinks ? <a class="code" href="repository_8h.html#a81b3bfcf5f278b47905e1b636394155">MAX_LINK_LEVELS</a> : 1); redirCount++) {
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#08ff705379463e5d355c4ef0942d7250">isLocalProperty</a>(aurl)) {
<a name="l00535"></a>00535             <span class="keywordflow">if</span> (aurl.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html#9e90fb1eb460c600234f029ad7e09fc7" title="Url is complete when it has also the host part (i.e. it begins with &amp;quot;rdk://&amp;quot;)...">isComplete</a>()) aurl = aurl.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html#1f0e7e4aa59080900c84f132c1f96c30">getPath</a>();
<a name="l00536"></a>00536             map&lt;Url, Property*&gt;::iterator it = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#66a9dd626a4daf33d0eff91cde9d816d">localProperties</a>.find(aurl);
<a name="l00537"></a>00537             <span class="keywordflow">if</span> (it == <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#66a9dd626a4daf33d0eff91cde9d816d">localProperties</a>.end()) {
<a name="l00538"></a>00538                 <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f02f1ae26ef18c2860c5be0974130184" title="Repository properties.">propertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00539"></a>00539                 <span class="keywordflow">throw</span> NoSuchProperty(<span class="stringliteral">"Property '"</span> + (<span class="keywordtype">string</span>) aurl + <span class="stringliteral">"' does not exists"</span>);
<a name="l00540"></a>00540             }
<a name="l00541"></a>00541             p = it-&gt;second;
<a name="l00542"></a>00542             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#9e9709f5e0fca4973d1138e8642fb5fd">deleted</a>) {
<a name="l00543"></a>00543                 <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f02f1ae26ef18c2860c5be0974130184" title="Repository properties.">propertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00544"></a>00544                 <span class="keywordflow">throw</span> NoSuchProperty(<span class="stringliteral">"Property '"</span> + (<span class="keywordtype">string</span>) aurl + <span class="stringliteral">"' has been deleted"</span>);
<a name="l00545"></a>00545             }
<a name="l00546"></a>00546             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#cd0dedc2d8e3c138252e4fe33846fbca">isLink</a>()) aurl = p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#0f75a8fee764ee6e6067e915dd91f660">linkTo</a>;
<a name="l00547"></a>00547             <span class="keywordflow">else</span> {
<a name="l00548"></a>00548                 <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f02f1ae26ef18c2860c5be0974130184" title="Repository properties.">propertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00549"></a>00549                 <span class="keywordflow">return</span> p;
<a name="l00550"></a>00550             }
<a name="l00551"></a>00551         }
<a name="l00552"></a>00552         <span class="keywordflow">else</span> {
<a name="l00553"></a>00553             <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f02f1ae26ef18c2860c5be0974130184" title="Repository properties.">propertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00554"></a>00554             <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#4497ee789162cfbdd0cbf5738eb7bbe1">getRemoteProperty</a>(aurl, <span class="keyword">this</span>);
<a name="l00555"></a>00555             <span class="keywordflow">return</span> p;
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557     }
<a name="l00558"></a>00558     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f02f1ae26ef18c2860c5be0974130184" title="Repository properties.">propertiesMutex</a>.<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00559"></a>00559     <span class="keywordflow">if</span> (followLinks) <span class="keywordflow">throw</span> InvalidOperation(<span class="stringliteral">"Too many link levels"</span>);
<a name="l00560"></a>00560     <span class="keywordflow">else</span> {
<a name="l00561"></a>00561         <span class="keywordflow">if</span> (p) <span class="keywordflow">return</span> p;
<a name="l00562"></a>00562         <span class="keywordflow">else</span> <span class="keywordflow">throw</span> InvalidOperation(<span class="stringliteral">"Something weird has happened"</span>);
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00566"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#cc45d1efe6a2cb39b1c83809811bb9a0">00566</a> <a class="code" href="struct_r_d_k2_1_1_repository_n_s_1_1_r_property_def.html">RPropertyDef</a>* <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#cc45d1efe6a2cb39b1c83809811bb9a0">Session::getRPropertyDef</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url)
<a name="l00567"></a>00567     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00568"></a>00568 {
<a name="l00569"></a>00569     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(url, <span class="keyword">false</span>);
<a name="l00570"></a>00570     <a class="code" href="struct_r_d_k2_1_1_repository_n_s_1_1_r_property_def.html">RPropertyDef</a>* pd;
<a name="l00571"></a>00571     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#be0897f8b3e71a3ccdc08a48bc5543b4">Profiler::lock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00572"></a>00572     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00573"></a>00573     pd = <span class="keyword">new</span> <a class="code" href="struct_r_d_k2_1_1_repository_n_s_1_1_r_property_def.html">RPropertyDef</a>(<span class="stringliteral">"rdk://"</span> + <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#18c69203f06d94792d55a2d22c81db9c">getRepositoryName</a>() + <span class="stringliteral">"/"</span> + url, *p);
<a name="l00574"></a>00574     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00575"></a>00575     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#6f8c98ddc3b3990d573fada126468f1e">Profiler::unlock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00576"></a>00576     <span class="keywordflow">return</span> pd;
<a name="l00577"></a>00577 }
<a name="l00578"></a>00578 
<a name="l00579"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ca24af26aabd3cba14795f7004d64df0">00579</a> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html">PropertyDef</a> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ca24af26aabd3cba14795f7004d64df0">Session::getPropertyDef</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url)
<a name="l00580"></a>00580     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html">PropertyDef</a> <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a>;
<a name="l00583"></a>00583     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url, <span class="keyword">false</span>);
<a name="l00584"></a>00584     r = p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#36173fd664943b9303c6a9786deb4e0e">getPropertyDef</a>();
<a name="l00585"></a>00585     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00586"></a>00586     <span class="keywordflow">return</span> r;
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00589"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#76ed824977336578ce236e08a10feb6e">00589</a> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html">PropertyDef</a> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#76ed824977336578ce236e08a10feb6e">Session::getDefaultPropertyDef</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url)
<a name="l00590"></a>00590     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00591"></a>00591 {
<a name="l00592"></a>00592     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html">PropertyDef</a> <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a>;
<a name="l00593"></a>00593     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#5972aa2ebce32134d1917a1beb53ba1b">lockAndGetProperty</a>(url, <span class="keyword">false</span>);
<a name="l00594"></a>00594     r = p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#646c614e778c51c4e7f79a3f649bac83">getDefaultPropertyDef</a>();
<a name="l00595"></a>00595     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#30eb88071d9da977c0d8da977e5b5b31">unlockProperty</a>(p);
<a name="l00596"></a>00596     <span class="keywordflow">return</span> r;
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00599"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#77ffc69c97214b5589cc2a39836333d9">00599</a> <span class="keywordtype">bool</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#77ffc69c97214b5589cc2a39836333d9">Session::isPersistent</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (InvalidOperation, NoSuchProperty)
<a name="l00600"></a>00600 {
<a name="l00601"></a>00601     <span class="keywordflow">return</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(url)-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#0a5e78a802681a43e297ff1949973531">isPersistent</a>();
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00604"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#35a4ea44e0df4dd3058b66d61b1426a1">00604</a> <span class="keywordtype">bool</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#35a4ea44e0df4dd3058b66d61b1426a1" title="Set the &amp;quot;persistent&amp;quot; attribute on properties.">Session::isReadonly</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (InvalidOperation, NoSuchProperty)
<a name="l00605"></a>00605 {
<a name="l00606"></a>00606     <span class="keywordflow">return</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(url)-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#30db905a8012f4f16cf60ff91fc60ab6">isReadonly</a>();
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#8bbb0abe80a862e505c8fd330cc3a7c2">00609</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#8bbb0abe80a862e505c8fd330cc3a7c2">Session::setPropertyOptions</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url, <a class="code" href="namespace_r_d_k2_1_1_repository_n_s.html#c53c49e1ec9483252eba4fa0358c2709">PropertyOptions</a> options)
<a name="l00610"></a>00610     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00611"></a>00611 {
<a name="l00612"></a>00612     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html">Property</a>* p = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(url);
<a name="l00613"></a>00613     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#be0897f8b3e71a3ccdc08a48bc5543b4">Profiler::lock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00614"></a>00614     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#45e42845140324802a68a81ec1d9ee09">lock</a>(<a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00615"></a>00615     p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#b0ad867aee184c863ec90b0320911dc5">options</a> = options;
<a name="l00616"></a>00616     <span class="keywordflow">if</span> (options &amp; <a class="code" href="namespace_r_d_k2_1_1_repository_n_s.html#c53c49e1ec9483252eba4fa0358c270998c5d16549f60192853f86d51d595ef5">NOT_PERSISTENT</a>) p-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#2d98d6a9843049bcd2dc560cba9e0c1f">def</a>.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property_def.html#41a9395a9d7d58cea1eecc25d046b613">setVolatile</a>();
<a name="l00617"></a>00617     p-&gt;<a class="code" href="class_posix_constructs_1_1_posix_mutex.html#f735e71d6e450bfc520527f37fab8edc">unlock</a>();
<a name="l00618"></a>00618     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#6f8c98ddc3b3990d573fada126468f1e">Profiler::unlock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + url).c_str());
<a name="l00619"></a>00619 }
<a name="l00620"></a>00620 
<a name="l00621"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#270b81c8fe28287231c87a49beff371d">00621</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#270b81c8fe28287231c87a49beff371d">Session::setObject</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url, <a class="code" href="class_r_d_k2_1_1_object.html" title="La nuova e purificata RDK2::Object.">RDK2::Object</a>* <span class="keywordtype">object</span>)
<a name="l00622"></a>00622     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation, WrongType)
<a name="l00623"></a>00623 {
<a name="l00624"></a>00624     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00625"></a>00625     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a> aurl = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url);
<a name="l00626"></a>00626     <span class="comment">// FIXME usare la cache delle property</span>
<a name="l00627"></a>00627     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#81447cd687a67017ff315bc88e1e2892">setObject</a>(aurl, <span class="keywordtype">object</span>);
<a name="l00628"></a>00628     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#910168f3e423244821546ed87bf5eeca">valueChanged</a>(aurl);
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 
<a name="l00631"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#9de61e0ce3ef8dff63f2111183028589">00631</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#9de61e0ce3ef8dff63f2111183028589">Session::declareDiffL</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url, <a class="code" href="struct_r_d_k2_1_1_meta_1_1_object_diff.html">ObjectDiff</a>* <a class="code" href="namespace_r_d_k2_1_1_geometry.html#ca50330bc469817022e9f3d0fd824714">diff</a>)
<a name="l00632"></a>00632     <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634     <span class="comment">// XXX strictly this is not "L" because it does not need a lock/unlock, though it will be called in a lock/unlock</span>
<a name="l00635"></a>00635     <span class="comment">// the diff will be actually pushed in the diffQueue when valueChanged is called</span>
<a name="l00636"></a>00636     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00637"></a>00637     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#1bb41594488cd6e67f9e0284bb1251db">pendingDiffs</a>[<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url)].push_back(<a class="code" href="namespace_r_d_k2_1_1_geometry.html#ca50330bc469817022e9f3d0fd824714">diff</a>);
<a name="l00638"></a>00638 }
<a name="l00639"></a>00639 
<a name="l00640"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#910168f3e423244821546ed87bf5eeca">00640</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#910168f3e423244821546ed87bf5eeca">Session::valueChanged</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00641"></a>00641 {
<a name="l00642"></a>00642     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#0551925ae140c870a77ca285bbbeb308" title="Lock the selected property.">lock</a>(url, <a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00645"></a>00645     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#a707e4e966e704a8b17e99e0ee993e38">getObjectL</a>(url)-&gt;<a class="code" href="class_r_d_k2_1_1_object.html#a7169fe7113ae98c1fbd7a4e6e85f37f">updateTimestamp</a>();
<a name="l00646"></a>00646     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e21d09ed10b43b7a43fe9e864e1edc60" title="Unlock the selected property.">unlock</a>(url);
<a name="l00647"></a>00647 
<a name="l00648"></a>00648     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a> aurl = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url);
<a name="l00649"></a>00649     vector&lt;ObjectDiff*&gt;&amp; diffs = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#1bb41594488cd6e67f9e0284bb1251db">pendingDiffs</a>[aurl];
<a name="l00650"></a>00650     <span class="comment">//RDK_DEBUG_PRINTF("Value changed: %u diffs for property %s", diffs.size(), aurl.c_str());</span>
<a name="l00651"></a>00651     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#e3fa75e3b45d7700baa4967b8c3ff84b">valueChanged</a>(aurl, diffs);
<a name="l00652"></a>00652     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; diffs.size(); i++) <span class="keyword">delete</span> diffs[i];
<a name="l00653"></a>00653     diffs.clear();
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00656"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#14df8d80af5e52d2a8ab1025b78ba963">00656</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#14df8d80af5e52d2a8ab1025b78ba963">Session::remotePropertyOptions</a>(
<a name="l00657"></a>00657     <a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url, <a class="code" href="namespace_network.html#9a6df6b6859c04260f7cabd19dabaa8c">Network::NetProtocol</a> socketType,
<a name="l00658"></a>00658     <a class="code" href="struct_r_d_k2_1_1_repository_n_s_1_1_r_remote_subscription.html#6f498d29cb6513d485ccb28883d98a7f">RRemoteSubscription::What</a> what,
<a name="l00659"></a>00659     <a class="code" href="struct_r_d_k2_1_1_repository_n_s_1_1_r_remote_subscription.html#9665b6066c81fedc1098ff960c437478">RRemoteSubscription::When</a> when, <span class="keywordtype">double</span> period)
<a name="l00660"></a>00660         <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00661"></a>00661 {
<a name="l00662"></a>00662     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#ff936230f47beed933e20e2d72252a8c">checkStarted</a>();
<a name="l00663"></a>00663     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#945b37576ba1ba71e61268b9bd2e3dd5">remotePropertyOptions</a>(
<a name="l00664"></a>00664         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url), socketType, what, when, period);
<a name="l00665"></a>00665 }
<a name="l00666"></a>00666 
<a name="l00667"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#c4384510082a0643387f1fe4ec94a5b3">00667</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#c4384510082a0643387f1fe4ec94a5b3">Session::storageSubscribeValue</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (NoSuchProperty, InvalidOperation)
<a name="l00668"></a>00668 {
<a name="l00669"></a>00669     <a class="code" href="logging_8h.html#41ce83f634d8fc364eaed15ee5cbf4b7">RDK_DEBUG_PRINTF</a>(<span class="stringliteral">"Storage subscribing %s"</span>, url.c_str());
<a name="l00670"></a>00670     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#d236be4bde92ccb417e1f68d1f933a4a">getProperty</a>(url);   <span class="comment">// this will automatically "subscribe" the value if the property is remote</span>
<a name="l00671"></a>00671 }
<a name="l00672"></a>00672 
<a name="l00673"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e3dc32f26ef6b4b51e90993f9dedfbce">00673</a> <span class="keywordtype">void</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e3dc32f26ef6b4b51e90993f9dedfbce">Session::storageUnsubscribeValue</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a>) throw (NoSuchProperty, InvalidOperation)
<a name="l00674"></a>00674 {
<a name="l00675"></a>00675     <span class="comment">// FIXME: vuoto?</span>
<a name="l00676"></a>00676 }
<a name="l00677"></a>00677 
<a name="l00678"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#bb33e9ffe7076e14a1f6f0937b0cb918">00678</a> <span class="keywordtype">string</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#bb33e9ffe7076e14a1f6f0937b0cb918">Session::textConfigLineForProperty</a>(<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">CUrl</a> relativeUrl)
<a name="l00679"></a>00679 {
<a name="l00680"></a>00680     <span class="comment">// FIXME DC: che schifo</span>
<a name="l00681"></a>00681     <span class="keywordtype">string</span> ret;
<a name="l00682"></a>00682     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#be0897f8b3e71a3ccdc08a48bc5543b4">Profiler::lock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + relativeUrl).c_str());
<a name="l00683"></a>00683     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#0551925ae140c870a77ca285bbbeb308" title="Lock the selected property.">lock</a>(relativeUrl, <a class="code" href="stack_8h.html#3fe03e23176f4fe277d1d3b41f3d3d06">HERE</a>);
<a name="l00684"></a>00684     <span class="keywordtype">string</span> linkTo = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#0f5a482adfcc2da7da750fcb95246caa">getPropertyLinkTo</a>(relativeUrl);
<a name="l00685"></a>00685     <a class="code" href="struct_r_d_k2_1_1_repository_n_s_1_1_r_property_def.html">RPropertyDef</a>* rpd = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#cc45d1efe6a2cb39b1c83809811bb9a0">getRPropertyDef</a>(relativeUrl);
<a name="l00686"></a>00686     <span class="keywordflow">if</span> (linkTo != <span class="stringliteral">""</span>) {
<a name="l00687"></a>00687         <span class="comment">// it is a link</span>
<a name="l00688"></a>00688         ret = relativeUrl + <span class="stringliteral">"=@"</span> + linkTo;
<a name="l00689"></a>00689     }
<a name="l00690"></a>00690     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rpd-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#c381cbb58ec3e353fc8156e52b4c30e8" title="Valid when property has to be saved externally.">savedExternally</a>) {
<a name="l00691"></a>00691         ret = relativeUrl + <span class="stringliteral">"=$"</span> + rpd-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_property.html#186f3eba01f308eb842b2551348e7206">externalFilename</a>;
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693     <span class="keywordflow">else</span> {
<a name="l00694"></a>00694         <span class="comment">// it is neither a link nor it has to be saved externally</span>
<a name="l00695"></a>00695         <span class="keyword">const</span> <a class="code" href="class_r_d_k2_1_1_object.html" title="La nuova e purificata RDK2::Object.">RDK2::Object</a>* obj = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e1c51b627f98c8342e501b33ec4faf25">getObjectLC</a>(relativeUrl);
<a name="l00696"></a>00696         <span class="keywordflow">if</span> (!obj) {
<a name="l00697"></a>00697             ret = relativeUrl + <span class="stringliteral">"="</span>;
<a name="l00698"></a>00698         }
<a name="l00699"></a>00699         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="class_r_d_k2_1_1_object.html#1148b03a8f303bdb6f3af47f784f7627" title="Ritorna true se ha una rappresentazione &amp;quot;semplice&amp;quot; come stringa.">hasStringRepresentation</a>()) {
<a name="l00700"></a>00700             ret = relativeUrl + <span class="stringliteral">"="</span> + obj-&gt;<a class="code" href="class_r_d_k2_1_1_object.html#a8d3935e8ab98abb9055afb1bdb73182" title="Ritorna la rappresentazione come stringa.">getStringRepresentation</a>();
<a name="l00701"></a>00701         }
<a name="l00702"></a>00702         <span class="keywordflow">else</span> {
<a name="l00703"></a>00703             ret = <span class="stringliteral">"#ERROR, the object "</span> + relativeUrl + <span class="stringliteral">" does not have a string representation"</span>;
<a name="l00704"></a>00704         }
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#e21d09ed10b43b7a43fe9e864e1edc60" title="Unlock the selected property.">unlock</a>(relativeUrl);
<a name="l00707"></a>00707     <a class="code" href="struct_r_d_k2_1_1_profiling_1_1_profiler.html#6f8c98ddc3b3990d573fada126468f1e">Profiler::unlock</a>((<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#46c77f001e857729a000613ddc852215">sessionName</a> + <span class="stringliteral">":"</span> + relativeUrl).c_str());
<a name="l00708"></a>00708     <span class="keywordflow">return</span> ret;
<a name="l00709"></a>00709 }
<a name="l00710"></a>00710 
<a name="l00711"></a><a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#a62e0337ec786b3e73bd4230b7cd246c">00711</a> <span class="keywordtype">bool</span> <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#a62e0337ec786b3e73bd4230b7cd246c">Session::propertyExists</a>(<a class="code" href="namespace_r_d_k2_1_1_text_utils.html#fdf6da19875de4a1d2cce13f299ca4b9">cstr</a> url) <span class="keywordflow">throw</span> (InvalidOperation)
<a name="l00712"></a>00712 {
<a name="l00713"></a>00713     <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html">Url</a> aurl = <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#21a63108c47a913e2714ce2bb0195788" title="Get absolute url from (possibly relative).">getAbsoluteUrl</a>(url);
<a name="l00714"></a>00714     <span class="keywordflow">if</span> (!aurl.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html#389d18554fb89eaa2f7e20c60508dc88" title="Url is absolute if it isn&amp;#39;t complete and begins with a &amp;quot;/&amp;quot;.">isAbsolute</a>() &amp;&amp; !aurl.<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_url.html#9e90fb1eb460c600234f029ad7e09fc7" title="Url is complete when it has also the host part (i.e. it begins with &amp;quot;rdk://&amp;quot;)...">isComplete</a>()) {
<a name="l00715"></a>00715         <span class="keywordflow">throw</span> InvalidOperation(<span class="stringliteral">"Url has to be absolute or complete ('"</span> + aurl + <span class="stringliteral">"')"</span>);
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="keywordflow">try</span> {
<a name="l00719"></a>00719         <span class="comment">// throws NoSuchProperty (also if it has been deleted)</span>
<a name="l00720"></a>00720         <a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_session.html#dbfd0a9f951660f38fdf446eb6aa4d12">repository</a>-&gt;<a class="code" href="class_r_d_k2_1_1_repository_n_s_1_1_repository.html#f20366ba2df8ed460a799e44d504b108">getProperty</a>(aurl, <span class="keyword">this</span>);
<a name="l00721"></a>00721     }
<a name="l00722"></a>00722     <span class="keywordflow">catch</span> (<span class="keyword">const</span> NoSuchProperty&amp; e) {
<a name="l00723"></a>00723         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725     <span class="keywordflow">catch</span> (<span class="keyword">const</span> SessionException&amp; e) {
<a name="l00726"></a>00726         <span class="keywordflow">throw</span>(e);
<a name="l00727"></a>00727     }
<a name="l00728"></a>00728     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 
<a name="l00732"></a>00732 }} <span class="comment">// namespace</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Mar 3 15:04:25 2009 for OpenRDK by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
