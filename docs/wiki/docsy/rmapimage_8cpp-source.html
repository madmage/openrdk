<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>OpenRDK: rmapimage.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c9084856de39d2370684ea5387345f28.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_96988b6434b62dfcbfa4cb8936cee763.html">libraries</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_2e4f2d31b959059e49dce94198a3cf84.html">rdkcore</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_70692f49ba4173028d2cf8644b0bab48.html">rmaps</a>
  </div>
</div>
<div class="contents">
<h1>rmapimage.cpp</h1><a href="rmapimage_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> *    OpenRDK : OpenSource Robot Development Kit</span>
<a name="l00003"></a>00003 <span class="comment"> *    Copyright (C) 2007, 2008  Daniele Calisi, Andrea Censi (&lt;first_name&gt;.&lt;last_name&gt;@dis.uniroma1.it)</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *    This program is free software: you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment"> *    it under the terms of the GNU General Public License as published by</span>
<a name="l00007"></a>00007 <span class="comment"> *    the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00008"></a>00008 <span class="comment"> *    (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> *    This program is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment"> *    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="comment"> *    GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> *    You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment"> *    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;cfloat&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;cstring&gt;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="logging_8h.html">rdkcore/logging/logging.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="objectmanager_8h.html">rdkcore/object/objectmanager.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="walk__line_8h.html">rdkcore/geometry/walk_line.h</a>&gt;</span>
<a name="l00028"></a><a class="code" href="rmapimage_8cpp.html#abf8415093fb98fb0d75a21891caffed">00028</a> <span class="preprocessor">#define LOGGING_MODULE "RMapImage"</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="rmapimage_8h.html">rmapimage.h</a>"</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keyword">namespace </span>RDK2 { <span class="keyword">namespace </span>RMaps {
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <a class="code" href="namespace_r_d_k2_1_1_r_maps.html#1a1e3a0be3a17043f9e5ab318c57032f">RDK2_FACTORY</a>(RMapImage);
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keyword">using namespace </span>RDK2::Geometry;
<a name="l00037"></a>00037 <span class="keyword">using namespace </span>std;
<a name="l00038"></a>00038 
<a name="l00039"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#296ad494bd7a04e9f11c0e6d871b0b48">00039</a> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#296ad494bd7a04e9f11c0e6d871b0b48">RMapImage::RMapImage</a>() {
<a name="l00040"></a>00040     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a> = <span class="keyword">new</span> <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html">RImage</a>(255,255,<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#769876f4de3c48481e8271368035a430020a153dd6af8efc6c380fbd20d6da52" title="OpenRDK eight-colors map format.">RImage::C8</a>);
<a name="l00041"></a>00041     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a> = <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a> = <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#461764cba15a5885bf5298efc528a09e">theta</a> = 0;
<a name="l00042"></a>00042     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a> = 10000; <span class="comment">// mm</span>
<a name="l00043"></a>00043     <span class="comment">//isPatch = false;</span>
<a name="l00044"></a>00044 }
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#92db2a43dae3bd5bc826a1444c482e65">00046</a> RMapImage::~RMapImage() {
<a name="l00047"></a>00047     <span class="keyword">delete</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>;
<a name="l00048"></a>00048 }
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#99b5f55a3484c695197adb95eb4b70fd">00050</a> std::string <a class="code" href="namespace_r_d_k2_1_1_text_utils.html#98aa4cfa55946ea4d1fe00c650f3b23a">RMapImage::toString</a>()<span class="keyword"> const </span>{
<a name="l00051"></a>00051     <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a> topLeft,bottomRight;
<a name="l00052"></a>00052     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">buf2world</a>(0,0,topLeft.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, topLeft.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00053"></a>00053     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">buf2world</a>(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>()-1,<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>()-1,bottomRight.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, bottomRight.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00054"></a>00054     <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a> imax = <a class="code" href="namespace_r_d_k2_1_1_geometry.html#622feafd160df364c9e67c1aeaddd511">Point2d::max</a>(topLeft,bottomRight);
<a name="l00055"></a>00055     <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a> imin = <a class="code" href="namespace_r_d_k2_1_1_geometry.html#d4e283eaaa6ade98510bc0a2913f51e0">Point2d::min</a>(topLeft,bottomRight);
<a name="l00056"></a>00056     ostringstream oss;
<a name="l00057"></a>00057     oss &lt;&lt; <span class="stringliteral">"RImage{topleft: "</span> &lt;&lt; topLeft.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#ffc8fa32bba32e9861be51e5d6af46a3">toString</a>() &lt;&lt; <span class="stringliteral">" br "</span> &lt;&lt; 
<a name="l00058"></a>00058         bottomRight.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#ffc8fa32bba32e9861be51e5d6af46a3">toString</a>() &lt;&lt; <span class="stringliteral">" Min-max: "</span>
<a name="l00059"></a>00059     &lt;&lt; imin.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#ffc8fa32bba32e9861be51e5d6af46a3">toString</a>() &lt;&lt; <span class="stringliteral">" - "</span> &lt;&lt; imax.toString() &lt;&lt; <span class="stringliteral">"}"</span>;
<a name="l00060"></a>00060     <span class="keywordflow">return</span> oss.str();
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#9b2fe1c5d25a939371e570ced14defed">00063</a> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#296ad494bd7a04e9f11c0e6d871b0b48">RMapImage::RMapImage</a>(<span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>, <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>, <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#461764cba15a5885bf5298efc528a09e">theta</a>, <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a>, <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html">RImage</a>* <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>) {
<a name="l00064"></a>00064     this-&gt;x = x;
<a name="l00065"></a>00065     this-&gt;y = y;
<a name="l00066"></a>00066     this-&gt;theta = theta;
<a name="l00067"></a>00067     this-&gt;realWidth = realWidth;
<a name="l00068"></a>00068     this-&gt;image = image;
<a name="l00069"></a>00069     <span class="comment">//this-&gt;isPatch = false;</span>
<a name="l00070"></a>00070 }
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#3df4d748ce18721467413018581080b5">00072</a> <a class="code" href="class_r_d_k2_1_1_object.html" title="La nuova e purificata RDK2::Object.">RDK2::Object</a>* <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#3df4d748ce18721467413018581080b5">RMapImage::clone</a>()<span class="keyword"> const </span>{
<a name="l00073"></a>00073     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html">RMapImage</a> * rmi = <span class="keyword">new</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#296ad494bd7a04e9f11c0e6d871b0b48">RMapImage</a>(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>,<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>,<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#461764cba15a5885bf5298efc528a09e">theta</a>,<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a>,<span class="keyword">new</span> <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html">RImage</a>(*<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>));
<a name="l00074"></a>00074     <span class="comment">//rmi-&gt;isPatch=isPatch;</span>
<a name="l00075"></a>00075     
<a name="l00076"></a>00076     <span class="keywordflow">return</span> rmi;
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#79e7da42d24bc09401d8b88337ac2e6b">00079</a> <span class="keywordtype">void</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#79e7da42d24bc09401d8b88337ac2e6b">RMapImage::setPixelW</a>(<span class="keywordtype">double</span> wx, <span class="keywordtype">double</span> wy, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> color) {
<a name="l00080"></a>00080     <span class="keywordtype">int</span> bx, by;
<a name="l00081"></a>00081     <span class="keywordflow">if</span>(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(wx,wy,bx,by))
<a name="l00082"></a>00082         <span class="comment">//image-&gt;getPixels()[by][bx] = color;</span>
<a name="l00083"></a>00083         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#76c1ec2a8171948adfade77ddd56dfcf">setPixelB</a>(bx, by, color);
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#1d8e977da1dbced60c0c483f7f47d7dd">00086</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#1d8e977da1dbced60c0c483f7f47d7dd">RMapImage::getPixelW</a>(<span class="keywordtype">double</span> wx, <span class="keywordtype">double</span> wy)<span class="keyword"> const</span>
<a name="l00087"></a>00087 <span class="keyword"></span>{
<a name="l00088"></a>00088     <span class="keywordtype">int</span> bx, by;
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(wx, wy, bx, by)) <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(bx, by); <span class="comment">//return image-&gt;getPixels()[by][bx];</span>
<a name="l00090"></a>00090     <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="rmapimage_8h.html#37fa0a318e089b35481a192e9eaf101f">RImage::C8Obstacle</a>;
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00093"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#81c77de6d0af17384ecc0f81accfe4fb">00093</a> <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#81c77de6d0af17384ecc0f81accfe4fb">RMapImage::minWorldX</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>; }
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#3a32af165f523de5fc4ca6b04a1aab0e">00095</a> <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#3a32af165f523de5fc4ca6b04a1aab0e">RMapImage::maxWorldX</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a> + <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a>; }
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#989c8f46e13850a35da8338646ccf036">00097</a> <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#989c8f46e13850a35da8338646ccf036">RMapImage::minWorldY</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a> - <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a> / <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>() * <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>(); }
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#570d139bfa7f5c8d151525a7b9ce509c">00099</a> <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#570d139bfa7f5c8d151525a7b9ce509c">RMapImage::maxWorldY</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>; }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3">00101</a> <span class="keywordtype">bool</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">RMapImage::world2buf</a>(<span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">RDK2::Geometry::Point2d</a>&amp; w, <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">RDK2::Geometry::Point2i</a>&amp;b)<span class="keyword"> const </span>{
<a name="l00102"></a>00102     <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(w.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>,w.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>,b.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>,b.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00103"></a>00103 }
<a name="l00104"></a>00104 
<a name="l00105"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">00105</a> <span class="keywordtype">void</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">RMapImage::buf2world</a>(<span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">RDK2::Geometry::Point2i</a>&amp; b, <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">RDK2::Geometry::Point2d</a>&amp;w)<span class="keyword"> const </span>{
<a name="l00106"></a>00106     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">buf2world</a>(b.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>,b.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>,w.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>,w.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108         
<a name="l00109"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d0e700b481f992b4102135d48b262584">00109</a> <span class="keywordtype">bool</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">RMapImage::world2buf</a>(<span class="keywordtype">double</span> wx, <span class="keywordtype">double</span> wy, <span class="keywordtype">int</span>&amp; bx, <span class="keywordtype">int</span> &amp;by)<span class="keyword"> const </span>{
<a name="l00110"></a>00110     bx =(int)( (wx - <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>)*(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>()/<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a>));
<a name="l00111"></a>00111     by =(int)(-(wy - <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>)*(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>()/<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a>)); 
<a name="l00112"></a>00112     <span class="keywordflow">return</span> bx &gt;= 0 &amp;&amp; by &gt;= 0 &amp;&amp; bx &lt; <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>() &amp;&amp; by &lt; <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>();
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#2a9ed80c901c179f2c64b1bc1f3116de">00115</a> <span class="keywordtype">void</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">RMapImage::buf2world</a>(<span class="keywordtype">int</span> bx, <span class="keywordtype">int</span> by, <span class="keywordtype">double</span>&amp; wx, <span class="keywordtype">double</span>&amp; wy)<span class="keyword"> const</span>
<a name="l00116"></a>00116 <span class="keyword"></span>{
<a name="l00117"></a>00117     wx = (<a class="code" href="classdouble.html">double</a>) bx * <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a> / <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>() + <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>;
<a name="l00118"></a>00118     wy = (<a class="code" href="classdouble.html">double</a>) <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a> - by * <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a> / <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>();
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 
<a name="l00121"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#929ef8298c4563577939c53ba13af911">00121</a> <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">RMapImage::buf2world</a>(<span class="keywordtype">int</span> <a class="code" href="namespace_r_d_k2_1_1_r_primitive.html#4498bf3c478b0da9cb6eae30d90f97c1">d</a>)<span class="keyword"> const</span>
<a name="l00122"></a>00122 <span class="keyword"></span>{
<a name="l00123"></a>00123     <span class="comment">// d is a distance, not a coordinate</span>
<a name="l00124"></a>00124     <span class="keywordflow">return</span> (<span class="keywordtype">double</span>) (d * <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a> / <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>());
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#ddf1ae3ea574220ea435aa51607629c3">00127</a> <span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">RMapImage::world2buf</a>(<span class="keywordtype">double</span> <a class="code" href="namespace_r_d_k2_1_1_r_primitive.html#4498bf3c478b0da9cb6eae30d90f97c1">d</a>)<span class="keyword"> const</span>
<a name="l00128"></a>00128 <span class="keyword"></span>{
<a name="l00129"></a>00129     <span class="comment">// d is a distance, not a coordinate</span>
<a name="l00130"></a>00130     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) (d * <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>() / <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a>);
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0672a23504373e84abdff618702bd1e6">00133</a> <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0672a23504373e84abdff618702bd1e6">RMapImage::calcClearance_w</a>(<span class="keywordtype">double</span> wx, <span class="keywordtype">double</span> wy)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135     <span class="keywordtype">int</span> bx, by;
<a name="l00136"></a>00136     <span class="keywordflow">if</span> (!<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(wx, wy, bx, by)) <span class="keywordflow">return</span> 0;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#ef41bce6ba5b782e24b1a462b1fa18d2">calcClearance_b</a>(bx, by);
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#ef41bce6ba5b782e24b1a462b1fa18d2">00141</a> <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#ef41bce6ba5b782e24b1a462b1fa18d2">RMapImage::calcClearance_b</a>(<span class="keywordtype">int</span> bx, <span class="keywordtype">int</span> by)
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143     <span class="keywordtype">double</span> min_distance2 = DBL_MAX;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="keywordtype">int</span> <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a> = 1;
<a name="l00146"></a>00146     <span class="keywordtype">int</span> startx = bx;
<a name="l00147"></a>00147     <span class="keywordtype">int</span> starty = by;
<a name="l00148"></a>00148     <span class="keywordtype">int</span> found_countdown = -1;
<a name="l00149"></a>00149     <span class="keywordtype">int</span> max_r = <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>();
<a name="l00150"></a>00150     <span class="keywordflow">if</span> (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>() &lt; max_r) max_r = <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>();
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="keywordflow">while</span> (found_countdown == -1 || found_countdown &gt; 0) {
<a name="l00153"></a>00153         <span class="comment">// we start from the cell at the left of the last "circle"</span>
<a name="l00154"></a>00154         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespace_r_d_k2_1_1_r_primitive.html#4498bf3c478b0da9cb6eae30d90f97c1">d</a> = 0; <a class="code" href="namespace_r_d_k2_1_1_r_primitive.html#4498bf3c478b0da9cb6eae30d90f97c1">d</a> &lt; 4; <a class="code" href="namespace_r_d_k2_1_1_r_primitive.html#4498bf3c478b0da9cb6eae30d90f97c1">d</a>++) {
<a name="l00155"></a>00155             <span class="keywordtype">int</span> dx, dy, <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>, <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>;
<a name="l00156"></a>00156             <span class="keywordflow">switch</span> (<a class="code" href="namespace_r_d_k2_1_1_r_primitive.html#4498bf3c478b0da9cb6eae30d90f97c1">d</a>) {
<a name="l00157"></a>00157                 <span class="keywordflow">case</span> 0: x = (int) startx - r; y = (int) starty;       dx = 1;  dy = -1; <span class="keywordflow">break</span>;
<a name="l00158"></a>00158                 <span class="keywordflow">case</span> 1: x = (int) startx;     y = (int) starty - r;   dx = 1;  dy = 1; <span class="keywordflow">break</span>;
<a name="l00159"></a>00159                 <span class="keywordflow">case</span> 2: x = (int) startx + r; y = (int) starty;       dx = -1; dy = 1; <span class="keywordflow">break</span>;
<a name="l00160"></a>00160                 <span class="keywordflow">default</span>: x = (int) startx;        y = (int) starty + r;   dx = -1; dy = -1; <span class="keywordflow">break</span>;
<a name="l00161"></a>00161             }
<a name="l00162"></a>00162             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; r; i++) {
<a name="l00163"></a>00163                 <span class="keywordflow">if</span> (y + i * dy &lt; 0 || y + i * dy &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>()
<a name="l00164"></a>00164                 ||  x + i * dx &lt; 0 || x + i * dx &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>()
<a name="l00165"></a>00165                 <span class="comment">//||    image-&gt;getPixels()[y + i * dy][x + i * dx] == C8Obstacle</span>
<a name="l00166"></a>00166                 || <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(x+i*dx, y+i*dy) == <a class="code" href="rmapimage_8h.html#37fa0a318e089b35481a192e9eaf101f">C8Obstacle</a>
<a name="l00167"></a>00167                 ) {
<a name="l00168"></a>00168                     <span class="keywordtype">int</span> ax = bx - (x + i * dx);
<a name="l00169"></a>00169                     <span class="keywordtype">int</span> ay = by - (y + i * dy);
<a name="l00170"></a>00170                     <span class="keywordtype">double</span> distance2 = ax * ax + ay * ay;
<a name="l00171"></a>00171                     <span class="keywordflow">if</span> (distance2 &lt; min_distance2) {
<a name="l00172"></a>00172                         <span class="comment">// this is a better minimum distance</span>
<a name="l00173"></a>00173                         min_distance2 = distance2;
<a name="l00174"></a>00174                         <span class="comment">// if it's the first obstacle we find, we start the countdown</span>
<a name="l00175"></a>00175                         <span class="keywordflow">if</span> (found_countdown == -1) found_countdown = (int) ((<span class="keywordtype">double</span>) r * 0.2929 + 1);
<a name="l00176"></a>00176                     }
<a name="l00177"></a>00177                 }
<a name="l00178"></a>00178             }
<a name="l00179"></a>00179         }
<a name="l00180"></a>00180         <span class="keywordflow">if</span> (found_countdown &gt; 0) found_countdown--;
<a name="l00181"></a>00181         r++;
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (r &gt; max_r) <span class="keywordflow">break</span>;    <span class="comment">// defensive programming</span>
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184     <span class="keywordflow">return</span> sqrt(min_distance2) * <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a> / <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>();
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#28a58e0497e0ee28e941dafbf3b808af">00187</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#28a58e0497e0ee28e941dafbf3b808af">RMapImage::markLine</a>(
<a name="l00188"></a>00188     <span class="comment">// da </span>
<a name="l00189"></a>00189     <span class="keywordtype">int</span> from_x, <span class="keywordtype">int</span> from_y, 
<a name="l00190"></a>00190     <span class="comment">// a</span>
<a name="l00191"></a>00191     <span class="keywordtype">int</span> to_x, <span class="keywordtype">int</span> to_y, 
<a name="l00192"></a>00192     <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height,
<a name="l00193"></a>00193     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image_1_1point.html">point</a>*<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#a9839da7e704d741b660f7ef7c52597c">line</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxLineLength) 
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count = 0;
<a name="l00196"></a>00196     <span class="keywordtype">int</span> x0,y0,x1,y1;
<a name="l00197"></a>00197     <span class="keywordflow">if</span>( abs(to_x-from_x) &gt; abs(to_y-from_y) ) {
<a name="l00198"></a>00198         x0 = from_x; x1=to_x;
<a name="l00199"></a>00199         y0 = from_y; y1=to_y;
<a name="l00200"></a>00200         <span class="keywordtype">int</span> inc = (to_x&gt;from_x) ? 1:-1;
<a name="l00201"></a>00201         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>=x0;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>!=x1 &amp;&amp; (count &lt; maxLineLength);<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>+=inc) {
<a name="l00202"></a>00202             <span class="keywordflow">if</span>(x&lt;0 || x&gt;=width) <span class="keywordflow">continue</span>;
<a name="l00203"></a>00203             <span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a> = y0 + (x-x0)*(y1-y0)/(x1-x0);
<a name="l00204"></a>00204             <span class="keywordflow">if</span>(y&gt;=0 &amp;&amp; y&lt;height ){
<a name="l00205"></a>00205                 line[count].<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image_1_1point.html#507ce824f70d6324d72c74d2d923c763">x</a> = x;
<a name="l00206"></a>00206                 line[count].<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image_1_1point.html#f42c4a9b4433ec82bea7fe6f37bd93ba">y</a> = y;
<a name="l00207"></a>00207                 count ++;
<a name="l00208"></a>00208             }   
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210     } <span class="keywordflow">else</span> {
<a name="l00211"></a>00211         x0 = from_x; x1=to_x;
<a name="l00212"></a>00212         y0 = from_y; y1=to_y;
<a name="l00213"></a>00213         <span class="keywordtype">int</span> inc = (to_y&gt;from_y) ? 1:-1;
<a name="l00214"></a>00214         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>=y0;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>!=y1 &amp;&amp; (count &lt; maxLineLength);<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>+=inc) {
<a name="l00215"></a>00215             <span class="keywordflow">if</span>(y&lt;0 || y&gt;=height) <span class="keywordflow">continue</span>;
<a name="l00216"></a>00216             <span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a> = x0 + (y-y0)*(x1-x0)/(y1-y0);
<a name="l00217"></a>00217             <span class="keywordflow">if</span>(x&gt;=0 &amp;&amp; x&lt;width ) {
<a name="l00218"></a>00218                 line[count].<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image_1_1point.html#507ce824f70d6324d72c74d2d923c763">x</a> = x;
<a name="l00219"></a>00219                 line[count].<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image_1_1point.html#f42c4a9b4433ec82bea7fe6f37bd93ba">y</a> = y;
<a name="l00220"></a>00220                 count ++;
<a name="l00221"></a>00221             }   
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224     
<a name="l00225"></a>00225     <span class="keywordflow">return</span> count;
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#a9839da7e704d741b660f7ef7c52597c">00228</a> <span class="keywordtype">void</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#a9839da7e704d741b660f7ef7c52597c">RMapImage::line</a>(<span class="keywordtype">int</span> x0, <span class="keywordtype">int</span> y0, <span class="keywordtype">int</span> x1, <span class="keywordtype">int</span> y1, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> color) {
<a name="l00229"></a>00229     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespace_r_d_k2_1_1_geometry.html#622feafd160df364c9e67c1aeaddd511">max</a> = 5000;
<a name="l00230"></a>00230     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image_1_1point.html">point</a> coords[5000];
<a name="l00231"></a>00231     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ncoords = <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#28a58e0497e0ee28e941dafbf3b808af">markLine</a>(x0, y0, x1, y1, <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>(), <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>(),
<a name="l00232"></a>00232         coords, max);
<a name="l00233"></a>00233     <span class="comment">//unsigned char** buf =(unsigned char**) image-&gt;getPixels();</span>
<a name="l00234"></a>00234     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> a=0;a&lt;ncoords;a++) {
<a name="l00235"></a>00235         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a> = coords[a].<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image_1_1point.html#507ce824f70d6324d72c74d2d923c763">x</a>;
<a name="l00236"></a>00236         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a> = coords[a].<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image_1_1point.html#f42c4a9b4433ec82bea7fe6f37bd93ba">y</a>;   
<a name="l00237"></a>00237         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#76c1ec2a8171948adfade77ddd56dfcf">setPixelB</a>(x, y, color); <span class="comment">//buf[y][x]=color;</span>
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 <span class="comment">/* F deve implementare</span>
<a name="l00243"></a>00243 <span class="comment">    bool shouldStop(x,y)</span>
<a name="l00244"></a>00244 <span class="comment">*/</span>
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt;
<a name="l00248"></a><a class="code" href="namespace_r_d_k2_1_1_r_maps.html#e187ac9adcc673257e7c0a4844de6107">00248</a> <span class="keywordtype">bool</span> <a class="code" href="namespace_r_d_k2_1_1_r_maps.html#e187ac9adcc673257e7c0a4844de6107">markLine2</a>(
<a name="l00249"></a>00249     <span class="comment">// da </span>
<a name="l00250"></a>00250     <span class="keywordtype">int</span> from_x, <span class="keywordtype">int</span> from_y, 
<a name="l00251"></a>00251     <span class="comment">// a</span>
<a name="l00252"></a>00252     <span class="keywordtype">int</span> to_x, <span class="keywordtype">int</span> to_y, 
<a name="l00253"></a>00253     <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height,
<a name="l00254"></a>00254     F&amp;f) 
<a name="l00255"></a>00255 {
<a name="l00256"></a>00256     <span class="keywordtype">int</span> x0,y0,x1,y1;
<a name="l00257"></a>00257     <span class="keywordflow">if</span>( abs(to_x-from_x) &gt; abs(to_y-from_y) ) {
<a name="l00258"></a>00258         x0 = from_x; x1=to_x;
<a name="l00259"></a>00259         y0 = from_y; y1=to_y;
<a name="l00260"></a>00260         <span class="keywordtype">int</span> inc = (to_x&gt;from_x) ? 1:-1;
<a name="l00261"></a>00261         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>=x0;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>!=x1;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>+=inc) {
<a name="l00262"></a>00262             <span class="keywordflow">if</span>(x&lt;0 || x&gt;=width) <span class="keywordflow">continue</span>;
<a name="l00263"></a>00263             <span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a> = y0 + (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>-x0)*(y1-y0)/(x1-x0);
<a name="l00264"></a>00264             <span class="keywordflow">if</span>(y&gt;=0 &amp;&amp; y&lt;height ){
<a name="l00265"></a>00265                 <span class="keywordflow">if</span>(f.shouldStop(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>,y))
<a name="l00266"></a>00266                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00267"></a>00267             }
<a name="l00268"></a>00268         }
<a name="l00269"></a>00269     } <span class="keywordflow">else</span> {
<a name="l00270"></a>00270         x0 = from_x; x1=to_x;
<a name="l00271"></a>00271         y0 = from_y; y1=to_y;
<a name="l00272"></a>00272         <span class="keywordtype">int</span> inc = (to_y&gt;from_y) ? 1:-1;
<a name="l00273"></a>00273         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>=y0;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>!=y1 ;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>+=inc) {
<a name="l00274"></a>00274             <span class="keywordflow">if</span>(y&lt;0 || y&gt;=height) <span class="keywordflow">continue</span>;
<a name="l00275"></a>00275             <span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a> = x0 + (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>-y0)*(x1-x0)/(y1-y0);
<a name="l00276"></a>00276             <span class="keywordflow">if</span>(x&gt;=0 &amp;&amp; x&lt;width ) {
<a name="l00277"></a>00277                 <span class="keywordflow">if</span>(f.shouldStop(x,<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>))
<a name="l00278"></a>00278                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00279"></a>00279             }
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282     
<a name="l00283"></a>00283     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="comment">/*</span>
<a name="l00288"></a>00288 <span class="comment">enum RayTracingResult { </span>
<a name="l00289"></a>00289 <span class="comment">            Obstacle, // abbiamo preso un ostacolo, ritorna distanza ostacolo</span>
<a name="l00290"></a>00290 <span class="comment">            Free,     // non abbiamo preso niente entro maxdist</span>
<a name="l00291"></a>00291 <span class="comment">            Unknown,  // abbiamo attraversato il blu, ritorna distanza libera</span>
<a name="l00292"></a>00292 <span class="comment">            Margin    // abbiamo sforato</span>
<a name="l00293"></a>00293 <span class="comment">}; */</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 
<a name="l00296"></a>00296 <span class="keyword">struct </span>Ant {
<a name="l00297"></a>00297     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>**buf;
<a name="l00298"></a>00298     <span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>,<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>;
<a name="l00299"></a>00299     
<a name="l00300"></a>00300     <span class="keywordtype">bool</span> shouldStop(<span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>,<span class="keywordtype">int</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>) {
<a name="l00301"></a>00301         <span class="keyword">this</span> -&gt; x = x;
<a name="l00302"></a>00302         <span class="keyword">this</span> -&gt; y = y;
<a name="l00303"></a>00303     
<a name="l00304"></a>00304         <span class="keywordflow">if</span>(buf[y][x]!=<a class="code" href="rmapimage_8h.html#7ea408b2cb12b39556dc268eff9a8425">C8Free</a>) {
<a name="l00305"></a>00305             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00306"></a>00306         }
<a name="l00307"></a>00307         
<a name="l00308"></a>00308         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 };
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#055adf24ccad0f0a33128014907600a7">00313</a> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc">RMapImage::RayTracingResult</a> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#055adf24ccad0f0a33128014907600a7">RMapImage::rayTracing2</a>(
<a name="l00314"></a>00314     <span class="keywordtype">double</span> px, <span class="keywordtype">double</span> py, <span class="keywordtype">double</span> ptheta,
<a name="l00315"></a>00315     <span class="keywordtype">double</span> maxdist, <span class="keywordtype">double</span>&amp; result)<span class="keyword"> const</span>
<a name="l00316"></a>00316 <span class="keyword"></span>{
<a name="l00317"></a>00317     <a class="code" href="logging_8h.html#771f0310bc59f63f2ccf8042f2f2a381">RDK_ERROR_PRINTF</a>(<span class="stringliteral">"Function deprecated"</span>);
<a name="l00318"></a>00318     <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc">RMapImage::RayTracingResult</a>(0);
<a name="l00319"></a>00319 <span class="preprocessor">#if 0</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>    <span class="keywordtype">double</span> p2x = px + cos(ptheta) * maxdist * 1.1;
<a name="l00321"></a>00321     <span class="keywordtype">double</span> p2y = py + sin(ptheta) * maxdist * 1.1;
<a name="l00322"></a>00322     
<a name="l00323"></a>00323     <span class="keywordtype">int</span> x0,x1,y0,y1;
<a name="l00324"></a>00324     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(px,   py, x0, y0);
<a name="l00325"></a>00325     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(p2x, p2y, x1, y1);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <span class="comment">//unsigned char ** buf =(unsigned char**) image-&gt;getPixels();</span>
<a name="l00328"></a>00328     Ant ant;
<a name="l00329"></a>00329 <span class="comment">//  ant.buf = buf;</span>
<a name="l00330"></a>00330     ant.x = 0; ant.y = 0;
<a name="l00331"></a>00331     
<a name="l00332"></a>00332     <span class="keywordtype">bool</span> found = 
<a name="l00333"></a>00333         <a class="code" href="namespace_r_d_k2_1_1_r_maps.html#e187ac9adcc673257e7c0a4844de6107">markLine2</a>(x0, y0, x1, y1, 
<a name="l00334"></a>00334             <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>(), <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>(),
<a name="l00335"></a>00335             ant);
<a name="l00336"></a>00336     
<a name="l00337"></a>00337     <span class="keywordflow">if</span>(found) {
<a name="l00338"></a>00338         <span class="keywordtype">double</span> wx, wy;
<a name="l00339"></a>00339         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">buf2world</a>(ant.x,ant.y,wx,wy);
<a name="l00340"></a>00340         <span class="keywordtype">double</span> dist = sqrt((wx-px)*(wx-px)+(wy-py)*(wy-py));
<a name="l00341"></a>00341         result = dist;
<a name="l00342"></a>00342         
<a name="l00343"></a>00343         <span class="comment">//if(buf[ant.y][ant.x] == C8Unknown)</span>
<a name="l00344"></a>00344         <span class="keywordflow">if</span> (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(ant.x, ant.y) == <a class="code" href="rmapimage_8h.html#bc496d6789e930d9a9ed771da5fb4049">C8Unknown</a>)
<a name="l00345"></a>00345             <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc6a37f5410d3f989895baefa98d7a7027" title="abbiamo attraversato il blu, ritorna distanza libera">Unknown</a>;
<a name="l00346"></a>00346             
<a name="l00347"></a>00347         <span class="comment">//if(buf[ant.y][ant.x] == C8Obstacle) {</span>
<a name="l00348"></a>00348         <span class="keywordflow">if</span> (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(ant.x, ant.y) == <a class="code" href="rmapimage_8h.html#37fa0a318e089b35481a192e9eaf101f">C8Obstacle</a>) {
<a name="l00349"></a>00349             <span class="keywordflow">if</span>(result&lt;maxdist) {
<a name="l00350"></a>00350                 <span class="comment">// ostacolo</span>
<a name="l00351"></a>00351                 <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fcbc76a5d8829b2e2dbea6f1a9474780a5" title="abbiamo preso un ostacolo, ritorna distanza ostacolo">Obstacle</a>;
<a name="l00352"></a>00352             }
<a name="l00353"></a>00353             <span class="keywordflow">else</span> {
<a name="l00354"></a>00354                 <span class="comment">// tutto libero</span>
<a name="l00355"></a>00355                 <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc4d9bb9657fb0b03140dcb0ec52780784" title="non abbiamo preso niente entro maxdist">Free</a>;
<a name="l00356"></a>00356             }
<a name="l00357"></a>00357         }
<a name="l00358"></a>00358         <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc6a37f5410d3f989895baefa98d7a7027" title="abbiamo attraversato il blu, ritorna distanza libera">Unknown</a>;
<a name="l00359"></a>00359     }
<a name="l00360"></a>00360     
<a name="l00361"></a>00361     <span class="keywordtype">double</span> wx, wy;
<a name="l00362"></a>00362     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">buf2world</a>(ant.x,ant.y,wx,wy);
<a name="l00363"></a>00363     <span class="keywordtype">double</span> dist = sqrt((wx-px)*(wx-px)+(wy-py)*(wy-py));
<a name="l00364"></a>00364     result = dist;
<a name="l00365"></a>00365     <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc3b37f83f2c2885fae4b18bce0510e085" title="abbiamo sforato">Margin</a>;
<a name="l00366"></a>00366 <span class="preprocessor">#endif</span>
<a name="l00367"></a>00367 <span class="preprocessor"></span>}
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 <span class="keywordtype">void</span> RMapImage::walkVars(<span class="keywordtype">double</span> w1x, <span class="keywordtype">double</span> w1y, <span class="keywordtype">double</span> w2x, <span class="keywordtype">double</span> w2y,
<a name="l00370"></a>00370     <span class="keywordtype">int</span>&amp; p1x, <span class="keywordtype">int</span>&amp; p1y, <span class="keywordtype">int</span>&amp; p2x, <span class="keywordtype">int</span>&amp; p2y,
<a name="l00371"></a>00371     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; steps, <span class="keywordtype">int</span>&amp; vx, <span class="keywordtype">int</span>&amp; vy,
<a name="l00372"></a>00372     <span class="keywordtype">double</span>&amp; incx, <span class="keywordtype">double</span>&amp; incy)
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374     <span class="keywordflow">if</span> (w1x &lt; w2x || (w1x == w2x &amp;&amp; w1y &lt; w2y)) {
<a name="l00375"></a>00375         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(w1x, w1y, p1x, p1y);
<a name="l00376"></a>00376         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(w2x, w2y, p2x, p2y);
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378     <span class="keywordflow">else</span> {
<a name="l00379"></a>00379         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(w1x, w1y, p2x, p2y);
<a name="l00380"></a>00380         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(w2x, w2y, p1x, p1y);
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383     vx = (p1x &lt; p2x ? 1 : -1);
<a name="l00384"></a>00384     vy = (p1y &lt; p2y ? 1 : -1);
<a name="l00385"></a>00385     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stepsx = abs(p1x - p2x);
<a name="l00386"></a>00386     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stepsy = abs(p1y - p2y);
<a name="l00387"></a>00387     steps = (stepsx &gt; stepsy ? stepsx : stepsy);
<a name="l00388"></a>00388     incx = (<a class="code" href="classdouble.html">double</a>) stepsx / steps;
<a name="l00389"></a>00389     incy = (<a class="code" href="classdouble.html">double</a>) stepsy / steps;
<a name="l00390"></a>00390 }
<a name="l00391"></a>00391 
<a name="l00392"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33a2171c5d326a71899c4340fdffc1bc">00392</a> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc">RMapImage::RayTracingResult</a> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33a2171c5d326a71899c4340fdffc1bc">RMapImage::visibilityCheck</a>(<span class="keywordtype">double</span> w0x, <span class="keywordtype">double</span> w0y, <span class="keywordtype">double</span> w1x, <span class="keywordtype">double</span> w1y, <span class="keywordtype">double</span>* distancePtr)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394 <span class="comment">/*  int x0, y0, x1,y1;</span>
<a name="l00395"></a>00395 <span class="comment">    world2buf(p0x, p0y, x0, y0);</span>
<a name="l00396"></a>00396 <span class="comment">    world2buf(p1x, p1y, x1, y1);*/</span>
<a name="l00397"></a>00397 
<a name="l00398"></a>00398     
<a name="l00399"></a>00399     <span class="keywordtype">int</span> p0x, p0y, p1x, p1y, vx, vy;
<a name="l00400"></a>00400     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> steps;
<a name="l00401"></a>00401     <span class="keywordtype">double</span> incx, incy;
<a name="l00402"></a>00402     walkVars(w0x, w0y, w1x, w1y, p0x, p0y, p1x, p1y, steps, vx, vy, incx, incy);
<a name="l00403"></a>00403     
<a name="l00404"></a>00404     <span class="keywordflow">if</span> (!steps) <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc4d9bb9657fb0b03140dcb0ec52780784" title="non abbiamo preso niente entro maxdist">Free</a>;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a> = p0x, <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a> = p0y;
<a name="l00407"></a>00407     
<a name="l00408"></a>00408     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc">RayTracingResult</a> currentResult = <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc4d9bb9657fb0b03140dcb0ec52780784" title="non abbiamo preso niente entro maxdist">Free</a>;
<a name="l00409"></a>00409     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; steps; i++) {
<a name="l00410"></a>00410         <span class="keywordtype">int</span> ix = (int) x, iy = (<span class="keywordtype">int</span>) y;
<a name="l00411"></a>00411         <span class="keywordflow">if</span> (ix &lt; 0 || iy &lt; 0 || ix &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>() || iy &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>()) <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fcbc76a5d8829b2e2dbea6f1a9474780a5" title="abbiamo preso un ostacolo, ritorna distanza ostacolo">Obstacle</a>;
<a name="l00412"></a>00412         <span class="comment">//else if (image-&gt;getPixels()[(int) y][(int) x] == C8Obstacle) {</span>
<a name="l00413"></a>00413         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(x, y) == <a class="code" href="rmapimage_8h.html#37fa0a318e089b35481a192e9eaf101f">C8Obstacle</a>) {
<a name="l00414"></a>00414             <span class="keywordflow">if</span> (distancePtr) *distancePtr = sqrt((p0x - x) * (p0x - x) + (p0y - y) * (p0y - y));
<a name="l00415"></a>00415             <span class="keywordflow">return</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fcbc76a5d8829b2e2dbea6f1a9474780a5" title="abbiamo preso un ostacolo, ritorna distanza ostacolo">Obstacle</a>;
<a name="l00416"></a>00416         }
<a name="l00417"></a>00417         <span class="comment">//else if (image-&gt;getPixels()[(int) y][(int) x] == C8Unknown) {</span>
<a name="l00418"></a>00418         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(x, y) == <a class="code" href="rmapimage_8h.html#bc496d6789e930d9a9ed771da5fb4049">C8Unknown</a>) {
<a name="l00419"></a>00419             <span class="keywordflow">if</span> (distancePtr) *distancePtr = sqrt((p0x - x) * (p0x - x) + (p0y - y) * (p0y - y));
<a name="l00420"></a>00420             currentResult = <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#428d7bfbc0b9c2feaf12b77fb3fd45fc6a37f5410d3f989895baefa98d7a7027" title="abbiamo attraversato il blu, ritorna distanza libera">Unknown</a>;
<a name="l00421"></a>00421         }
<a name="l00422"></a>00422         x += incx * vx;
<a name="l00423"></a>00423         y += incy * vy;
<a name="l00424"></a>00424     }
<a name="l00425"></a>00425     <span class="keywordflow">return</span> currentResult;
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 
<a name="l00429"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#dec6eee9941b3d3cf09f99c594319631">00429</a> <span class="keywordtype">void</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#dec6eee9941b3d3cf09f99c594319631">RMapImage::distMapRayTracing</a>(<span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a>&amp; start, <span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a>&amp; end, <span class="keywordtype">bool</span>&amp; hitSomething, <span class="keywordtype">int</span> min_dist_from_wall)
<a name="l00430"></a>00430 {
<a name="l00431"></a>00431     <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2i</a> startb, endb;
<a name="l00432"></a>00432     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>, startb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, startb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00433"></a>00433     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(end.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, end.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>, endb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, endb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00434"></a>00434     <a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html">LineWalk</a> lw(startb, endb);
<a name="l00435"></a>00435     
<a name="l00436"></a>00436     <span class="keywordflow">do</span> {
<a name="l00437"></a>00437         <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2i</a> p = lw.<a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html#b4d0608f7765ef90dc6b7bcf434d2964">getPoint</a>();
<a name="l00438"></a>00438         <span class="keywordflow">if</span> (p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a> &lt; 0 || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a> &lt; 0 || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a> &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>() || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a> &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>()) {
<a name="l00439"></a>00439             hitSomething = <span class="keyword">true</span>;
<a name="l00440"></a>00440             <span class="keywordflow">return</span>;
<a name="l00441"></a>00441         }
<a name="l00442"></a>00442         
<a name="l00443"></a>00443                  <span class="comment">//if (image-&gt;getPixels()[p.y][p.x]&lt; min_dist_from_wall) {</span>
<a name="l00444"></a>00444                  <span class="keywordflow">if</span> (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>) &lt; min_dist_from_wall) {
<a name="l00445"></a>00445             hitSomething = <span class="keyword">true</span>;
<a name="l00446"></a>00446             <span class="keywordflow">return</span>;
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     } <span class="keywordflow">while</span> (lw.<a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html#cb7d378a7cab0569c4c4e053ed4a91c7">next</a>());
<a name="l00450"></a>00450     
<a name="l00451"></a>00451     hitSomething = <span class="keyword">false</span>;
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#69b10edd82bb79b630cfe5386a8d1902">00454</a> <span class="keywordtype">double</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#69b10edd82bb79b630cfe5386a8d1902">RMapImage::obsDenRayTracing</a>(<span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a>&amp; start, <span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a>&amp; end)
<a name="l00455"></a>00455 {
<a name="l00456"></a>00456     <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2i</a> startb, endb;
<a name="l00457"></a>00457     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>, startb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, startb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00458"></a>00458     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(end.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, end.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>, endb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, endb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00459"></a>00459     <a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html">LineWalk</a> lw(startb, endb);
<a name="l00460"></a>00460     <span class="keywordtype">double</span> result=0;
<a name="l00461"></a>00461     <span class="keywordflow">do</span> {
<a name="l00462"></a>00462         <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2i</a> p = lw.<a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html#b4d0608f7765ef90dc6b7bcf434d2964">getPoint</a>();
<a name="l00463"></a>00463         <span class="keywordflow">if</span> (p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a> &lt; 0 || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a> &lt; 0 || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a> &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>() || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a> &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>()) {
<a name="l00464"></a>00464             <span class="keywordflow">continue</span>;
<a name="l00465"></a>00465         }
<a name="l00466"></a>00466                 <span class="keywordtype">double</span> tmp;
<a name="l00467"></a>00467         <span class="comment">//if(image-&gt;getPixels()[p.x][p.y]==0)</span>
<a name="l00468"></a>00468         <span class="keywordflow">if</span> (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>) == 0)
<a name="l00469"></a>00469                   tmp=2.0;
<a name="l00470"></a>00470                 <span class="keywordflow">else</span>
<a name="l00471"></a>00471                    <span class="comment">//tmp=1.0/(double)(image-&gt;getPixels()[p.x][p.y]);</span>
<a name="l00472"></a>00472                    tmp = 1.0 / (<a class="code" href="classdouble.html">double</a>) (<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>));
<a name="l00473"></a>00473              
<a name="l00474"></a>00474                 result+=tmp;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     } <span class="keywordflow">while</span> (lw.<a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html#cb7d378a7cab0569c4c4e053ed4a91c7">next</a>());
<a name="l00477"></a>00477     
<a name="l00478"></a>00478     <span class="keywordflow">return</span> result;
<a name="l00479"></a>00479 }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#5196e16a8de810e8f7f56384c876c05c">00482</a> <span class="keywordtype">void</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#5196e16a8de810e8f7f56384c876c05c">RMapImage::rayTracing</a>(<span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a>&amp; start, <span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a>&amp; end, <span class="keyword">const</span> <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_c8_set.html">RC8Set</a>* obstacleColors,
<a name="l00483"></a>00483     <span class="keywordtype">bool</span>&amp; hitSomething, <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#1a31b676f6aab4b27331e816c1a6cbe9">RImage::C8Color</a>&amp; colorHit)
<a name="l00484"></a>00484 {
<a name="l00485"></a>00485     <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2i</a> startb, endb;
<a name="l00486"></a>00486     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>, startb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, startb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00487"></a>00487     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(end.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, end.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>, endb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, endb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00488"></a>00488     <a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html">LineWalk</a> lw(startb, endb);
<a name="l00489"></a>00489     
<a name="l00490"></a>00490     <span class="keywordflow">do</span> {
<a name="l00491"></a>00491         <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2i</a> p = lw.<a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html#b4d0608f7765ef90dc6b7bcf434d2964">getPoint</a>();
<a name="l00492"></a>00492         <span class="keywordflow">if</span> (p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a> &lt; 0 || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a> &lt; 0 || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a> &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>() || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a> &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>()) {
<a name="l00493"></a>00493             hitSomething = <span class="keyword">true</span>;
<a name="l00494"></a>00494             colorHit = <a class="code" href="rmapimage_8h.html#37fa0a318e089b35481a192e9eaf101f">C8Obstacle</a>;
<a name="l00495"></a>00495             <span class="keywordflow">return</span>;
<a name="l00496"></a>00496         }
<a name="l00497"></a>00497         <span class="comment">//if (obstacleColors-&gt;contains(image-&gt;getPixels()[p.y][p.x])) {</span>
<a name="l00498"></a>00498         <span class="keywordflow">if</span> (obstacleColors-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_c8_set.html#dd3bd04fe350b62b552c868473784f57">contains</a>(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>))) {
<a name="l00499"></a>00499             hitSomething = <span class="keyword">true</span>;
<a name="l00500"></a>00500             <span class="comment">//colorHit = (RImage::C8Color) image-&gt;getPixels()[p.y][p.x];</span>
<a name="l00501"></a>00501             colorHit = (<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#1a31b676f6aab4b27331e816c1a6cbe9">RImage::C8Color</a>) <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00502"></a>00502             <span class="keywordflow">return</span>;
<a name="l00503"></a>00503         }
<a name="l00504"></a>00504     } <span class="keywordflow">while</span> (lw.<a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html#cb7d378a7cab0569c4c4e053ed4a91c7">next</a>());
<a name="l00505"></a>00505     
<a name="l00506"></a>00506     hitSomething = <span class="keyword">false</span>;
<a name="l00507"></a>00507 }
<a name="l00508"></a>00508 
<a name="l00509"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#9fe2519ba62e3b66b8f4baa9397bd180">00509</a> <span class="keywordtype">bool</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#5196e16a8de810e8f7f56384c876c05c">RMapImage::rayTracing</a>(<span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a>&amp; start, <span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a>&amp; end, <span class="keyword">const</span> <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_c8_set.html">RC8Set</a>* obstacleColors,
<a name="l00510"></a>00510     <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a>* collisionPoint, <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#1a31b676f6aab4b27331e816c1a6cbe9">RImage::C8Color</a>* colorHit)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512     <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2i</a> startb, endb;
<a name="l00513"></a>00513     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>, startb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, startb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00514"></a>00514     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(end.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, end.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>, endb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, endb.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00515"></a>00515     <a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html">LineWalk</a> lw(startb, endb);
<a name="l00516"></a>00516     
<a name="l00517"></a>00517     <span class="keywordflow">do</span> {
<a name="l00518"></a>00518         <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2i</a> p = lw.<a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html#b4d0608f7765ef90dc6b7bcf434d2964">getPoint</a>();
<a name="l00519"></a>00519         <span class="keywordflow">if</span> (p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a> &lt; 0 || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a> &lt; 0 || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a> &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>() || p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a> &gt;= <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>()) {
<a name="l00520"></a>00520             <span class="keywordflow">if</span> (colorHit) *colorHit = (<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#1a31b676f6aab4b27331e816c1a6cbe9">RImage::C8Color</a>) <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00521"></a>00521             <span class="keywordflow">if</span> (collisionPoint) <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">buf2world</a>(p, *collisionPoint);
<a name="l00522"></a>00522             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524         <span class="keywordflow">if</span> (obstacleColors-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_c8_set.html#dd3bd04fe350b62b552c868473784f57">contains</a>(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>))) {
<a name="l00525"></a>00525             <span class="keywordflow">if</span> (colorHit) *colorHit = (<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#1a31b676f6aab4b27331e816c1a6cbe9">RImage::C8Color</a>) <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#d174914acdc9d587ad15eff185d29e83">getPixelB</a>(p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a>, p.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a>);
<a name="l00526"></a>00526             <span class="keywordflow">if</span> (collisionPoint) <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#45df26991463c4aaa39575c18f196fec">buf2world</a>(p, *collisionPoint);
<a name="l00527"></a>00527             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00528"></a>00528         }
<a name="l00529"></a>00529     } <span class="keywordflow">while</span> (lw.<a class="code" href="class_r_d_k2_1_1_geometry_1_1_line_walk.html#cb7d378a7cab0569c4c4e053ed4a91c7">next</a>());
<a name="l00530"></a>00530     <span class="keywordflow">if</span> (collisionPoint) *collisionPoint = end;
<a name="l00531"></a>00531     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00534"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#a027fac98a6c776ea3d5c32805edfcb5">00534</a> <span class="keywordtype">bool</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#5196e16a8de810e8f7f56384c876c05c">RMapImage::rayTracing</a>(<span class="keyword">const</span> <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a>&amp; start, <span class="keywordtype">double</span> direction, <span class="keywordtype">double</span> maxDist, <span class="keyword">const</span> <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_c8_set.html">RC8Set</a>* obstacleColors,
<a name="l00535"></a>00535     <span class="keywordtype">double</span>* distance, <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#1a31b676f6aab4b27331e816c1a6cbe9">RImage::C8Color</a>* colorHit)
<a name="l00536"></a>00536 {
<a name="l00537"></a>00537     <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a> end(start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#09a7eaf02570d0bb69e6f87a5eb5fc5d">x</a> + cos(direction) * maxDist, start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#b5c6096fadbafd88d2a306bfbaf4856d">y</a> + sin(direction) * maxDist);
<a name="l00538"></a>00538     <a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html">Point2d</a> p;
<a name="l00539"></a>00539     <span class="keywordtype">bool</span> b = <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#5196e16a8de810e8f7f56384c876c05c">rayTracing</a>(start, end, obstacleColors, &amp;p, colorHit);
<a name="l00540"></a>00540     <span class="keywordflow">if</span> (distance) *distance = start.<a class="code" href="struct_r_d_k2_1_1_geometry_1_1_point2.html#2aba22808503edca6ff69ee2e50e1f08">distTo</a>(p);
<a name="l00541"></a>00541     <span class="keywordflow">return</span> b;
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00544"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#21d8f6535579c61057e9b04f9a3145bc">00544</a> <span class="keywordtype">void</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#21d8f6535579c61057e9b04f9a3145bc">RMapImage::read</a>(<a class="code" href="class_r_d_k2_1_1_serialization_1_1_reader.html">Reader</a>* <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a>) <span class="keywordflow">throw</span> (ReadingException)
<a name="l00545"></a>00545 {
<a name="l00546"></a>00546     <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a>-&gt;startReading(<a class="code" href="struct_r_d_k2_1_1_demangle_1_1_reflective.html#9277d1d6deb515a6cf603fd39caf08a8">getClassName</a>());
<a name="l00547"></a>00547         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a> = <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a>-&gt;read_f32();
<a name="l00548"></a>00548         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a> = <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a>-&gt;read_f32();
<a name="l00549"></a>00549         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#461764cba15a5885bf5298efc528a09e">theta</a> = <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a>-&gt;read_f32();
<a name="l00550"></a>00550         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a> = <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a>-&gt;read_f32();
<a name="l00551"></a>00551         <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a> = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html">RImage</a>*<span class="keyword">&gt;</span>(<a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a>-&gt;readObject());
<a name="l00552"></a>00552     <a class="code" href="namespace_r_d_k2_1_1_statistics.html#2cc9ddc62c90fc4ea788deaadf3753dc">r</a>-&gt;doneReading();
<a name="l00553"></a>00553 }
<a name="l00554"></a>00554 
<a name="l00555"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0ba526db7d1a1b1ea44e9fd147677db5">00555</a> <span class="keywordtype">void</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0ba526db7d1a1b1ea44e9fd147677db5">RMapImage::write</a>(<a class="code" href="class_r_d_k2_1_1_serialization_1_1_writer.html">Writer</a>* w) <span class="keyword">const</span> <span class="keywordflow">throw</span> (WritingException)
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557     w-&gt;startWriting(<a class="code" href="struct_r_d_k2_1_1_demangle_1_1_reflective.html#9277d1d6deb515a6cf603fd39caf08a8">getClassName</a>());
<a name="l00558"></a>00558         w-&gt;write_f32(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>, <span class="stringliteral">"x"</span>);
<a name="l00559"></a>00559         w-&gt;write_f32(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>, <span class="stringliteral">"y"</span>);
<a name="l00560"></a>00560         w-&gt;write_f32(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#461764cba15a5885bf5298efc528a09e">theta</a>, <span class="stringliteral">"theta"</span>);
<a name="l00561"></a>00561         w-&gt;write_f32(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a>, <span class="stringliteral">"realWidth"</span>);
<a name="l00562"></a>00562         w-&gt;writeObject(<span class="keyword">true</span>, <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>, <span class="stringliteral">"image"</span>);
<a name="l00563"></a>00563     w-&gt;doneWriting();
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00566"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#4df9c5e3f00482fc5932061c3ae5f5b7">00566</a> <span class="keywordtype">void</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#4df9c5e3f00482fc5932061c3ae5f5b7">RMapImage::move</a>(<span class="keywordtype">double</span> xnew, <span class="keywordtype">double</span> ynew, <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html">RImage</a> * init){
<a name="l00567"></a>00567     <span class="keywordtype">int</span> xmin, ymin;
<a name="l00568"></a>00568 <span class="comment">//  RDK_DEBUG_PRINTF("xnew %.2f, ynew %.2f",xnew,ynew);</span>
<a name="l00569"></a>00569     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(xnew,ynew,xmin,ymin);
<a name="l00570"></a>00570     <span class="keywordtype">int</span> xmax=xmin+<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>(), ymax = ymin+<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>();
<a name="l00571"></a>00571     <span class="keywordtype">int</span> xsize=<a class="code" href="namespace_r_d_k2_1_1_geometry.html#d4e283eaaa6ade98510bc0a2913f51e0">std::min</a>(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>(),(size_t)xmax)-<a class="code" href="namespace_r_d_k2_1_1_geometry.html#622feafd160df364c9e67c1aeaddd511">std::max</a>(0,xmin);
<a name="l00572"></a>00572     <span class="keywordtype">int</span> ysize=<a class="code" href="namespace_r_d_k2_1_1_geometry.html#d4e283eaaa6ade98510bc0a2913f51e0">std::min</a>(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#56e8dc8d5c37d9aea7fd6802fb5f6555">getHeight</a>(),(size_t)ymax)-<a class="code" href="namespace_r_d_k2_1_1_geometry.html#622feafd160df364c9e67c1aeaddd511">std::max</a>(0,ymin);
<a name="l00573"></a>00573     <span class="keywordtype">int</span> startx=<a class="code" href="namespace_r_d_k2_1_1_geometry.html#622feafd160df364c9e67c1aeaddd511">std::max</a>(0,xmin), starty=<a class="code" href="namespace_r_d_k2_1_1_geometry.html#622feafd160df364c9e67c1aeaddd511">std::max</a>(0,ymin);
<a name="l00574"></a>00574     <span class="keywordtype">int</span> startx2=-<a class="code" href="namespace_r_d_k2_1_1_geometry.html#d4e283eaaa6ade98510bc0a2913f51e0">std::min</a>(0,xmin), starty2=-<a class="code" href="namespace_r_d_k2_1_1_geometry.html#d4e283eaaa6ade98510bc0a2913f51e0">std::min</a>(0,ymin);
<a name="l00575"></a>00575 <span class="comment">//  RDK_DEBUG_PRINTF("x:(%d,%d), y:(%d,%d), size:(%d,%d)",xmin,xmax,ymin,ymax,xsize,ysize);</span>
<a name="l00576"></a>00576 <span class="comment">//  RDK_DEBUG_PRINTF("start:(%d,%d), start2:(%d,%d)",startx,starty,startx2,starty2);</span>
<a name="l00577"></a>00577     <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html">RImage</a> *newImage = <span class="keyword">new</span> <a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html">RImage</a>(*init);
<a name="l00578"></a>00578     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * ibuf = <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#753521af4fc78f65cd7725830f4757b0">getBuffer</a>();
<a name="l00579"></a>00579     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * buf = newImage-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#753521af4fc78f65cd7725830f4757b0">getBuffer</a>();
<a name="l00580"></a>00580     ibuf+=startx;
<a name="l00581"></a>00581     ibuf+=starty*<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>();
<a name="l00582"></a>00582     buf+=startx2;
<a name="l00583"></a>00583     buf+=starty2*newImage-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>();
<a name="l00584"></a>00584     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;ysize;i++) {
<a name="l00585"></a>00585         memcpy(buf,ibuf,xsize);
<a name="l00586"></a>00586         ibuf+=<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>();
<a name="l00587"></a>00587         buf+=newImage-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#0ee8f4e4acf98cf73b809d60d3babcaa">getWidth</a>();
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589     this-&gt;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>=xnew;
<a name="l00590"></a>00590     this-&gt;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>=ynew;
<a name="l00591"></a>00591     <span class="keyword">delete</span> this-&gt;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>;
<a name="l00592"></a>00592     this-&gt;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>=newImage;
<a name="l00593"></a>00593     
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 
<a name="l00596"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#af7793ff90dc1d9e31ee554f8113c953">00596</a> <span class="keywordtype">void</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#af7793ff90dc1d9e31ee554f8113c953">RMapImage::canvasReshape</a>(<span class="keywordtype">double</span> wd, <span class="keywordtype">double</span> hg, <span class="keywordtype">double</span> anch_x, <span class="keywordtype">double</span> anch_y,<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> init_value){
<a name="l00597"></a>00597     <span class="keywordtype">int</span> anch_u,anch_v;
<a name="l00598"></a>00598     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fdaa1fd9418016743c2ae19b4d2398c3" title="ritorna true se dentro">world2buf</a>(anch_x,anch_y,anch_u,anch_v);
<a name="l00599"></a>00599 <span class="comment">//      RDK_DEBUG_PRINTF("w h %f %f",wd,hg);</span>
<a name="l00600"></a>00600     <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#f2e99189683ae487b4b3765b4383e9c3">image</a>-&gt;<a class="code" href="class_r_d_k2_1_1_r_graphics_1_1_r_image.html#71bfe4539094c0ee6da650ed99154870">canvasResize</a>((<span class="keywordtype">int</span>)(wd/<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#ae57608936908051f9c7b4f284e12f19">getMapDelta</a>()),(<span class="keywordtype">int</span>)(hg/<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#ae57608936908051f9c7b4f284e12f19">getMapDelta</a>()),anch_u,anch_v,init_value);
<a name="l00601"></a>00601     this-&gt;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a>=wd;
<a name="l00602"></a>00602     this-&gt;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>=anch_x;
<a name="l00603"></a>00603     this-&gt;<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>=anch_y;
<a name="l00604"></a>00604 }
<a name="l00605"></a>00605 
<a name="l00606"></a><a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fd095154b26f39aa56e7c4b649d36f53">00606</a> <span class="keywordtype">bool</span> <a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#fd095154b26f39aa56e7c4b649d36f53">RMapImage::centeredRobot</a>(<span class="keywordtype">double</span> rpx, <span class="keywordtype">double</span> rpy,<span class="keywordtype">double</span> * new_x, <span class="keywordtype">double</span>* new_y, <span class="keywordtype">double</span> off_size){
<a name="l00607"></a>00607 <span class="comment">//      RDK_DEBUG_PRINTF("sono centrato? rpx %f x %f rpy %f y %f realWidth %f realHeight %f ",rpx,x,rpy,y,realWidth,getRealHeight());</span>
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     <span class="keywordflow">if</span>( (rpy-<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>)&lt;-off_size &amp;&amp; (rpy-<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#33d6666f3908067c57a2ac56165247e6">y</a>)&gt;(-<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#597024e2afdcd692d2c4f279da3f178a">getRealHeight</a>()+off_size) &amp;&amp;
<a name="l00610"></a>00610             (rpx-<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>)&gt;off_size &amp;&amp; (rpx-<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#85d2d1c23faae28df696c0170b76119c">x</a>)&lt;(<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a>-off_size))
<a name="l00611"></a>00611         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00612"></a>00612 
<a name="l00613"></a>00613     *new_x=rpx-<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#0b0700f5e994ff8d198ad64e8638897c">realWidth</a>/2.0;
<a name="l00614"></a>00614     *new_y=rpy+<a class="code" href="struct_r_d_k2_1_1_r_maps_1_1_r_map_image.html#597024e2afdcd692d2c4f279da3f178a">getRealHeight</a>()/2.0;
<a name="l00615"></a>00615 <span class="comment">//      RDK_DEBUG_PRINTF("non ero centrato... adesso new_x %f neww_y %f",*new_x,*new_y); </span>
<a name="l00616"></a>00616     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619 }} <span class="comment">// namespaces</span>
<a name="l00620"></a>00620 
<a name="l00621"></a>00621 <span class="preprocessor">#include "<a class="code" href="rmapimage__diffs_8cpp.html">rmapimage_diffs.cpp</a>"</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Mar 3 15:04:25 2009 for OpenRDK by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
